<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KANCEL√Å≈ò NADƒöJE v2.1</title>
    
    <script src="stats.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root { 
            --neon: #00f2ff; 
            --dark: #0f172a; 
            --card-bg: rgba(255, 255, 255, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body { 
            background: var(--dark); 
            color: white; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            padding: 15px; 
            text-align: center; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            overflow-x: hidden; 
        }

        /* ANIMOVAN√â LOGO V2.1 - PULZOV√ÅN√ç A Z√Å≈òE */
        .header-logo { 
            max-width: 480px; 
            width: 90%; 
            margin: 25px 0 40px 0;
            filter: drop-shadow(0 0 12px rgba(0, 242, 255, 0.4)); 
            animation: neonPulse 3.5s ease-in-out infinite alternate; 
            cursor: pointer;
        }

        @keyframes neonPulse {
            from { 
                filter: drop-shadow(0 0 10px rgba(0, 242, 255, 0.4)); 
                transform: scale(1); 
            }
            to { 
                filter: drop-shadow(0 0 25px rgba(0, 242, 255, 0.9)); 
                transform: scale(1.03); 
            }
        }

        /* FIXN√ç ADMIN TLAƒå√çTKO - ABY SE NEPOSOUVALO S LOGEM */
        .admin-lock {
            position: fixed; 
            top: 20px; 
            right: 20px;
            width: 48px; 
            height: 48px;
            background: rgba(15, 23, 42, 0.85);
            border: 2px solid var(--neon);
            border-radius: 50%;
            display: flex; 
            align-items: center; 
            justify-content: center;
            text-decoration: none; 
            font-size: 1.3em;
            z-index: 9999; 
            transition: var(--transition);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
            backdrop-filter: blur(8px);
        }
        .admin-lock:hover { 
            background: var(--neon); 
            transform: rotate(20deg) scale(1.1); 
            box-shadow: 0 0 30px var(--neon); 
        }

        /* BANK BOX */
        .bank-box { 
            background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,242,255,0.1)); 
            border: 1px solid var(--neon); 
            border-radius: 24px; 
            padding: 30px; 
            min-width: 300px; 
            margin-bottom: 40px; 
            box-shadow: 0 0 35px rgba(0, 242, 255, 0.15); 
            transition: var(--transition);
        }
        .bank-box span { 
            font-size: 3em; 
            font-weight: 900; 
            text-shadow: 0 0 20px var(--neon); 
        }
        .bank-label { 
            display: block; 
            opacity: 0.5; 
            font-size: 0.75em; 
            letter-spacing: 3px; 
            margin-bottom: 10px; 
            text-transform: uppercase; 
        }

        .btn-stats { 
            display: inline-block; 
            margin-bottom: 35px; 
            padding: 14px 32px; 
            background: rgba(0, 242, 255, 0.05); 
            border: 1px solid var(--neon); 
            color: var(--neon); 
            text-decoration: none; 
            border-radius: 50px; 
            font-size: 0.95em; 
            font-weight: bold; 
            letter-spacing: 1px; 
            transition: var(--transition); 
        }
        .btn-stats:hover { 
            background: var(--neon); 
            color: black; 
            box-shadow: 0 0 30px var(--neon); 
        }

        /* Z√ÅPASY - MATCH CARDS */
        #matchList { width: 100%; max-width: 600px; }

        .match-card { 
            background: var(--card-bg); 
            border-radius: 28px; 
            border: 1px solid rgba(255,255,255,0.1); 
            margin-bottom: 30px; 
            padding: 30px; 
            cursor: pointer; 
            transition: var(--transition); 
            position: relative; 
            overflow: hidden;
        }
        .match-card:hover { 
            border-color: var(--neon); 
            background: rgba(255,255,255,0.08); 
            transform: translateY(-5px);
        }

        /* 3D VLAJKY ANIMACE */
        .flags-wrapper { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 15px; 
            margin: 15px 0;
        }
        .flag-container { 
            perspective: 1200px; 
            text-align: center; 
            width: 110px;
        }
        .flag-img { 
            width: 90px; 
            height: auto; 
            border-radius: 8px; 
            animation: flagWave 4.5s ease-in-out infinite; 
            transform-origin: left center; 
            border-left: 3px solid rgba(255,255,255,0.5);
            box-shadow: 0 15px 30px rgba(0,0,0,0.6);
        }
        @keyframes flagWave {
            0%, 100% { transform: rotateY(0deg) rotateX(0deg); }
            50% { transform: rotateY(25deg) rotateX(8deg); }
        }
        .country-name { 
            display: block; 
            font-size: 0.8em; 
            opacity: 0.6; 
            margin-top: 12px; 
            font-weight: 800; 
        }
        .vs { 
            background: var(--neon); 
            color: black; 
            border-radius: 50%; 
            width: 42px; 
            height: 42px; 
            line-height: 42px; 
            font-weight: 900; 
            font-size: 1em;
            box-shadow: 0 0 20px var(--neon);
        }

        .timer-box { 
            font-size: 0.9em; 
            font-weight: 800; 
            color: var(--neon); 
            background: rgba(0,0,0,0.6); 
            padding: 10px 22px; 
            border-radius: 50px; 
            border: 1px solid rgba(0,242,255,0.2);
        }

        /* FORMUL√Å≈ò A DETAILY */
        .details { 
            display: none; 
            padding-top: 35px; 
            border-top: 1px solid rgba(255,255,255,0.1); 
            margin-top: 30px; 
            text-align: left; 
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .input-label { font-size: 0.75em; font-weight: bold; opacity: 0.5; text-transform: uppercase; margin-bottom: 10px; display: block; letter-spacing: 1px; }
        .name-input { 
            width: 100%; padding: 18px; margin-bottom: 25px; 
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); 
            color: white; border-radius: 15px; font-size: 1em; box-sizing: border-box;
            transition: var(--transition);
        }
        .name-input:focus { border-color: var(--neon); outline: none; background: rgba(0,242,255,0.05); }

        .score-container { display: flex; justify-content: center; align-items: center; gap: 25px; margin: 15px 0 35px 0; }
        .score-input { 
            width: 85px; height: 70px; text-align: center; font-weight: 900; font-size: 2.2em; 
            background: #000; border: 2px solid #334155; color: white; border-radius: 18px; 
            transition: var(--transition);
        }
        .score-input:focus { border-color: var(--neon); box-shadow: 0 0 20px rgba(0,242,255,0.3); }

        /* P≈òEP√çNAƒå */
        .switch-row { display: flex; align-items: center; gap: 15px; margin: 25px 0; background: rgba(255,255,255,0.02); padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .switch { position: relative; display: inline-block; width: 52px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #334155; transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background: var(--neon); }
        input:checked + .slider:before { transform: translateX(24px); }

        .btn-add { 
            width: 100%; background: var(--neon); color: black; border: none; padding: 20px; 
            border-radius: 18px; font-weight: 900; cursor: pointer; font-size: 1.2em; 
            text-transform: uppercase; letter-spacing: 1.5px; transition: var(--transition);
        }
        .btn-add:hover { transform: scale(1.02); box-shadow: 0 10px 30px rgba(0,242,255,0.5); }

        /* S√ÅZKY OSTATN√çCH S PODBARVEN√çM */
        .bets-header { font-weight: 900; font-size: 0.9em; opacity: 0.4; margin: 40px 0 20px 0; text-transform: uppercase; letter-spacing: 2px; }
        .bet-row { 
            padding: 16px; border-radius: 18px; margin-bottom: 12px; 
            border-left: 5px solid var(--neon); display: flex; flex-direction: column; gap: 6px;
            transition: transform 0.2s;
        }
        .bet-row:hover { transform: scale(1.01); }
        .bet-main { display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 1.1em; }
        .bet-player { font-size: 0.9em; color: var(--neon); opacity: 0.8; font-weight: 600; }

        /* KO≈†√çK - TIKET */
        #cart { 
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); 
            width: 92%; max-width: 500px; background: #1e293b; border: 3px solid var(--neon); 
            border-radius: 35px; padding: 35px; display: none; z-index: 2000; 
            box-shadow: 0 0 80px rgba(0,0,0,0.95); 
        }
        .close-cart { position: absolute; top: 25px; right: 30px; font-size: 2.2em; cursor: pointer; opacity: 0.4; transition: 0.3s; }
        .close-cart:hover { opacity: 1; color: var(--neon); }
    </style>
</head>
<body>

    <a href="admin.html" class="admin-lock" title="Administrace">‚öôÔ∏è</a>

    <img src="IMG_8427.jpeg" alt="KANCEL√Å≈ò NADƒöJE" class="header-logo">

    <div class="bank-box">
        <span class="bank-label">Aktu√°ln√≠ v√Ωhra pro dne≈°ek</span>
        <span id="mainBank">0</span> Kƒç
    </div>

    <a href="statistiky.html" class="btn-stats">üìä ≈ΩEB≈ò√çƒåKY A STATISTIKY</a>

    <div id="matchList">
        <p style="opacity:0.5;">Naƒç√≠t√°m z√°pasy...</p>
    </div>

    <div id="cart">
        <span class="close-cart" onclick="closeCart()">√ó</span>
        <div id="cartContent">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="text-align:left;">
                    <b id="cartCount" style="font-size:1.4em;">0 z√°pas≈Ø</b><br>
                    <span id="cartTotal" style="color:var(--neon); font-size:2em; font-weight:900;">0 Kƒç</span>
                </div>
                <button id="sendBtn" class="btn-add" style="width:auto; padding: 15px 35px;" onclick="odeslatTiket()">ODESLAT</button>
            </div>
        </div>
        
        <div id="qrArea" style="display:none; text-align:center; margin-top:20px;">
            <div id="qrStatus" style="margin-bottom:25px; font-weight:900; color:var(--neon); font-size:1.4em;">‚úÖ TIPY BYLY ODESL√ÅNY!</div>
            <div style="background:white; padding:25px; border-radius:25px; display:inline-block; box-shadow: 0 0 40px rgba(255,255,255,0.15);">
                <img id="qrImg" src="" style="width:220px; display:block;">
            </div>
            <p id="qrDesc" style="font-size:1em; margin-top:25px; opacity:0.8; line-height:1.6;"></p>
            <button onclick="window.location.reload()" style="background:none; border:1px solid var(--neon); color:var(--neon); padding:10px 20px; border-radius:10px; cursor:pointer; margin-top:15px;">ZAV≈ò√çT</button>
        </div>
    </div>

<script>
    // --- KONFIGURACE FIREBASE ---
    const firebaseConfig = { 
        apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE", 
        authDomain: "nadeje-208bd.firebaseapp.com", 
        databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app", 
        projectId: "nadeje-208bd", 
        storageBucket: "nadeje-208bd.firebasestorage.app", 
        messagingSenderId: "688478977789", 
        appId: "1:688478977789:web:512d1520cf96c9e59cc894" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let kosik = {};
    let activeTimers = {};

    // --- POSLUCHAƒå DATAB√ÅZE ---
    db.ref('sazkyData').on('value', snap => {
        const data = snap.val() || {};
        const list = document.getElementById('matchList');
        list.innerHTML = "";
        
        if (!data.zapasy) {
            document.getElementById('mainBank').innerText = data.prevedenyBank || 0;
            list.innerHTML = "<p style='opacity:0.5; margin-top:50px;'>Moment√°lnƒõ nejsou vyps√°ny ≈æ√°dn√© z√°pasy.</p>";
            return;
        }

        const zapasy = Object.entries(data.zapasy).map(([id, m]) => ({id, ...m}));
        zapasy.sort((a,b) => new Date(a.deadline) - new Date(b.deadline));

        // Dynamick√Ω v√Ωpoƒçet banku
        const nejblizsi = zapasy[0];
        const vkladyZapas = nejblizsi.sazky ? Object.keys(nejblizsi.sazky).length * 20 : 0;
        document.getElementById('mainBank').innerText = parseInt(data.prevedenyBank || 0) + vkladyZapas;

        zapasy.forEach(m => {
            const id = m.id;
            activeTimers[id] = m.deadline;
            const isClosed = Date.now() > new Date(m.deadline).getTime();
            const isEvaluated = m.status === "vyhodnoceno";

            const card = document.createElement('div');
            card.className = "match-card";
            if(id === nejblizsi.id) card.style.borderColor = "var(--neon)";
            
            // VERZE 2: Dla≈ædice je v≈ædy klikac√≠ pro zobrazen√≠ tip≈Ø
            card.onclick = () => toggle(id);

            const timerHtml = isEvaluated 
                ? `<div class="timer-box" style="background: #27ae60; color: white; border: none;">‚úÖ VYHODNOCENO (${m.vysledek})</div>` 
                : `<div id="t-${id}" class="timer-box">--:--:--</div>`;

            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div style="color:var(--neon); font-size:0.8em; font-weight:900; letter-spacing:1px;">BANK: ${m.sazky ? Object.keys(m.sazky).length * 20 : 0} Kƒç</div>
                    ${timerHtml}
                </div>
                <div class="flags-wrapper">
                    <div class="flag-container">
                        <img class="flag-img" src="https://flagcdn.com/w160/${m.kodD}.png">
                        <span class="country-name">${m.domaci}</span>
                    </div>
                    <div class="vs">VS</div>
                    <div class="flag-container">
                        <img class="flag-img" src="https://flagcdn.com/w160/${m.kodH}.png">
                        <span class="country-name">${m.hoste}</span>
                    </div>
                </div>
                <div id="det-${id}" class="details" onclick="event.stopPropagation()">
                    
                    ${(!isClosed && !isEvaluated) ? `
                        <span class="input-label">Identifikace s√°zej√≠c√≠ho</span>
                        <input type="text" id="name-${id}" class="name-input" placeholder="Jm√©no nebo p≈ôezd√≠vka">
                        
                        <span class="input-label" style="text-align:center;">V√°≈° tip na v√Ωsledek (60 min)</span>
                        <div class="score-container">
                            <input type="number" id="sD-${id}" class="score-input">
                            <div style="font-weight:900; font-size:1.8em; color:var(--neon);">:</div>
                            <input type="number" id="sH-${id}" class="score-input">
                        </div>

                        <span class="input-label">St≈ôelec g√≥lu (tie-breaker)</span>
                        <input type="text" id="p-${id}" class="name-input" placeholder="nap≈ô. Pastr≈à√°k">
                        
                        <div class="switch-row">
                            <label class="switch">
                                <input type="checkbox" id="h-${id}">
                                <span class="slider"></span>
                            </label>
                            <span style="font-size:0.85em; opacity:0.8;">Skr√Ωt m≈Øj tip p≈ôed ostatn√≠mi do deadline</span>
                        </div>

                        <button class="btn-add" onclick="pridat('${id}')">P≈òIDAT NA TIKET (20 Kƒç)</button>
                    ` : `
                        <div style="text-align:center; background:rgba(255,68,68,0.1); padding:15px; border-radius:15px; margin-bottom:20px;">
                            <span style="color:#ff4444; font-weight:900;">üîí S√ÅZKY JSOU PRO TENTO Z√ÅPAS UZAV≈òENY</span>
                        </div>
                    `}
                    
                    <div class="bets-header">P≈ôehled tip≈Ø ostatn√≠ch</div>
                    <div id="bets-${id}"></div>
                </div>
            `;
            list.appendChild(card);

            // LOGIKA PODBARVEN√ç S√ÅZEK (DUPLICITY)
            if(m.sazky) {
                const countsSkore = {};
                const countsFull = {};
                
                Object.values(m.sazky).forEach(s => {
                    const full = `${s.skore}-${s.strelec.toLowerCase().trim()}`;
                    countsSkore[s.skore] = (countsSkore[s.skore] || 0) + 1;
                    countsFull[full] = (countsFull[full] || 0) + 1;
                });

                Object.values(m.sazky).forEach(s => {
                    const fullKey = `${s.skore}-${s.strelec.toLowerCase().trim()}`;
                    const showAll = isClosed || isEvaluated;
                    
                    let bgColor = "rgba(255,255,255,0.03)";
                    if (countsFull[fullKey] > 1) bgColor = "rgba(255, 165, 0, 0.2)"; // Oran≈æov√° - tot√°ln√≠ duplicita
                    else if (countsSkore[s.skore] > 1) bgColor = "rgba(255, 255, 0, 0.1)"; // ≈Ωlut√° - stejn√© sk√≥re

                    const row = `
                        <div class="bet-row" style="background: ${bgColor};">
                            <div class="bet-main">
                                <span>${s.stav || "‚è≥"} ${s.jmeno}</span>
                                <span style="color:var(--neon)">${(s.skryt && !showAll) ? '??:??' : s.skore}</span>
                            </div>
                            <div class="bet-player">
                                üèí ${(s.skryt && !showAll) ? '*******' : (s.strelec || '---')}
                            </div>
                        </div>`;
                    document.getElementById(`bets-${id}`).innerHTML += row;
                });
            } else {
                document.getElementById(`bets-${id}`).innerHTML = "<p style='opacity:0.3; font-size:0.8em; text-align:center;'>Zat√≠m ≈æ√°dn√© s√°zky.</p>";
            }
        });
    });

    function toggle(id) {
        const el = document.getElementById(`det-${id}`);
        const isVisible = el.style.display === 'block';
        
        // Zav≈ô√≠t v≈°echny ostatn√≠, aby byl web p≈ôehledn√Ω
        document.querySelectorAll('.details').forEach(d => d.style.display = 'none');
        
        if(!isVisible) el.style.display = 'block';
    }

    function closeCart() { document.getElementById('cart').style.display = 'none'; }

    function pridat(id) {
        const jm = document.getElementById(`name-${id}`).value;
        const sD = document.getElementById(`sD-${id}`).value;
        const sH = document.getElementById(`sH-${id}`).value;
        const p = document.getElementById(`p-${id}`).value;
        const skryt = document.getElementById(`h-${id}`).checked;

        if(!jm || sD === "" || sH === "" || !p) return alert("Pros√≠m vypl≈àte v≈°echna pole!");

        // Kontrola, zda nƒõkdo u≈æ nem√° p≈ôesnƒõ stejnou kombinaci
        db.ref(`sazkyData/zapasy/${id}/sazky`).once('value', snap => {
            const exist = snap.val() || {};
            const isDuplicit = Object.values(exist).some(s => 
                s.skore === `${sD}:${sH}` && s.strelec.toLowerCase().trim() === p.toLowerCase().trim()
            );
            
            if(isDuplicit) return alert("‚ö†Ô∏è Tuto kombinaci sk√≥re a st≈ôelce ji≈æ zvolil nƒõkdo jin√Ω. Zkus jin√©ho st≈ôelce pro stejn√© sk√≥re!");

            kosik[id] = { jmeno: jm, skore: `${sD}:${sH}`, strelec: p, skryt: skryt };
            
            document.getElementById('cartCount').innerText = `${Object.keys(kosik).length} z√°pas≈Ø na tiketu`;
            document.getElementById('cartTotal').innerText = `${Object.keys(kosik).length * 20} Kƒç`;
            document.getElementById('cart').style.display = 'block';
            
            // Po p≈ôid√°n√≠ detail zav≈ôeme
            toggle(id);
        });
    }

    function odeslatTiket() {
        const btn = document.getElementById('sendBtn');
        btn.disabled = true; 
        btn.innerText = "ODES√çL√ÅM...";
        
        let jmenoProQR = "";
        Object.entries(kosik).forEach(([mid, data]) => {
            db.ref(`sazkyData/zapasy/${mid}/sazky`).push({ ...data, stav: "‚è≥" });
            jmenoProQR = data.jmeno;
        });

        const suma = Object.keys(kosik).length * 20;
        const zprava = `Sazka_${jmenoProQR}`.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        
        document.getElementById('cartContent').style.display = 'none';
        document.getElementById('qrStatus').innerText = "‚úÖ TIPY BYLY ODESL√ÅNY!";
        document.getElementById('qrImg').src = `https://api.paylibo.com/paylibo/generator/czech/image?accountNumber=295511827&bankCode=0300&amount=${suma}&currency=CZK&message=${zprava}`;
        document.getElementById('qrDesc').innerHTML = `ƒå√°stka k √∫hradƒõ: <b>${suma} Kƒç</b><br>Zpr√°va pro p≈ô√≠jemce: <b>${zprava}</b><br><br><small>Tv√° s√°zka bude potvrzena, jakmile doraz√≠ platba.</small>`;
        document.getElementById('qrArea').style.display = 'block';
        
        kosik = {};
    }

    // INTERVAL PRO ODPORAV√ÅV√ÅN√ç ƒåASU
    setInterval(() => {
        const now = Date.now();
        Object.entries(activeTimers).forEach(([id, deadline]) => {
            const el = document.getElementById(`t-${id}`);
            if(!el) return;
            
            const diff = new Date(deadline).getTime() - now;
            if(diff <= 0) {
                el.innerText = "üîê ZAV≈òENO";
                el.style.color = "#ff4444";
                el.style.borderColor = "rgba(255,68,68,0.4)";
            } else {
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                el.innerText = `‚è±Ô∏è ${h}h ${m}m ${s}s`;
            }
        });
    }, 1000);
</script>
</body>
</html>
