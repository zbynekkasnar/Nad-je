<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√°zkov√° kancel√°≈ô NADƒöJE - ONLINE</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; padding-bottom: 80px; margin: 0; }
        .main-wrapper { width: 100%; max-width: 500px; box-shadow: 0 4px 25px rgba(0,0,0,0.1); border-radius: 15px; overflow: hidden; background: white; margin-bottom: 20px; }
        .logo-container { background: white; width: 100%; text-align: center; padding: 15px 0; border-bottom: 1px solid #eee; }
        .main-logo { max-width: 70%; height: auto; display: block; margin: 0 auto; }
        .header-image { width: 100%; height: 180px; object-fit: cover; display: block; background-color: #ddd; }
        .content-box { padding: 20px; }
        .bank-info { background: #2c3e50; color: #f1c40f; text-align: center; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 1.4em; font-weight: bold; width: 100%; max-width: 470px; }
        .zapas-nazev { text-align: center; font-size: 1.6em; font-weight: bold; margin-bottom: 15px; display: flex; justify-content: center; gap: 15px; align-items: center; }
        .vs-label { color: #e74c3c; font-size: 0.7em; background: #fceaea; padding: 2px 8px; border-radius: 5px; }
        .score-input { display: flex; align-items: center; justify-content: center; gap: 10px; margin: 10px 0; }
        input { padding: 12px; border: 2px solid #ddd; border-radius: 8px; outline: none; }
        input[type="number"] { width: 65px; text-align: center; font-size: 1.2em; }
        input[type="text"] { width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        .hide-option { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 15px; font-size: 0.9em; color: #555; cursor: pointer; }
        button { background: #28a745; color: white; border: none; padding: 15px; cursor: pointer; width: 100%; border-radius: 8px; font-weight: bold; font-size: 1.1em; transition: 0.2s; }
        button:hover { background: #218838; }
        #adminPanel { display: none; border: 2px dashed #e74c3c; background: #fff9f9; padding: 20px; border-radius: 15px; width: 100%; max-width: 460px; margin-bottom: 20px; }
        .admin-toggle { position: fixed; bottom: 20px; right: 20px; background: #34495e; color: white; width: 55px; height: 55px; border-radius: 50%; border: none; cursor: pointer; font-size: 24px; z-index: 100; }
        table { width: 100%; max-width: 700px; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; }
        th { background: #34495e; color: white; font-size: 0.8em; }
        .win { background: #d4edda !important; font-weight: bold; color: #155724; }
        .secret-cell { color: #999; font-style: italic; font-size: 0.8em; }
        .btn-red { background: #e74c3c; margin-bottom: 10px; }
        .btn-grey { background: #6c757d; }
        .btn-delete { background: #ff4757; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="bank-info" id="bankDisplay">üí∞ Naƒç√≠t√°n√≠ banku...</div>

    <div class="main-wrapper">
        <div class="logo-container">
            <img src="IMG_8423.jpeg" class="main-logo" alt="S√°zkov√° kancel√°≈ô NADƒöJE" onerror="this.alt='S√°zkov√° kancel√°≈ô NADƒöJE'">
        </div>
        <img id="hlavniObrazek" src="" class="header-image" style="display:none">
        
        <div class="content-box">u
            <div id="zobrazenyZapas" class="zapas-nazev">
                <span id="txtDomaci">...</span> <span class="vs-label">VS</span> <span id="txtHoste">...</span>
            </div>
            
            <input type="text" id="jmeno" placeholder="Tv√© jm√©no">
            <div class="score-input">
                <input type="number" id="tip_domaci" min="0" value="0">
                <span>:</span>
                <input type="number" id="tip_hoste" min="0" value="0">
            </div>
            <input type="text" id="tip_strelec" placeholder="Tip na st≈ôelce">
            
            <label class="hide-option">
                <input type="checkbox" id="skrytTip"> Skr√Ωt m≈Øj tip p≈ôed ostatn√≠mi üïµÔ∏è
            </label>

            <button onclick="ulozitSazku()">Odeslat s√°zku (20 Kƒç)</button>
        </div>
    </div>

    <div id="adminPanel">
        <h3 style="text-align:center; margin-top:0;">üõ† Administrace</h3>
        <input type="text" id="set_url" placeholder="URL fotky z√°pasu">
        <div style="display:flex; gap:5px; margin-bottom:10px;">
            <input type="text" id="set_domaci" placeholder="Dom√°c√≠ t√Ωm">
            <input type="text" id="set_hoste" placeholder="Hostuj√≠c√≠ t√Ωm">
        </div>
        <button onclick="nastavitZapas()" class="btn-grey" style="margin-bottom: 15px;">Aktualizovat z√°pas</button>
        <button onclick="odkrytAdmin()" class="btn-grey" style="margin-bottom: 20px; background: #5d6d7e;">Zobrazit skryt√© tipy (Admin)</button>
        
        <div class="score-input">
            <input type="number" id="real_domaci" min="0" value="0">
            <span>:</span>
            <input type="number" id="real_hoste" min="0" value="0">
        </div>
        <button onclick="vyhodnotit()" class="btn-red">Vyhodnotit & Jackpot</button>
        <div style="display:flex; gap:10px">
            <button onclick="smazatSazky()" class="btn-grey" style="flex:1">Nov√© kolo</button>
            <button onclick="zavritAdmin()" class="btn-grey" style="flex:1">Zav≈ô√≠t</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>S√°zka≈ô</th>
                <th>Tip</th>
                <th>St≈ôelec</th>
                <th>Stav</th>
                <th id="th-akce" style="display:none">Akce</th>
            </tr>
        </thead>
        <tbody id="tabulkaBody"></tbody>
    </table>

    <button class="admin-toggle" onclick="otevritAdmin()" title="Administrace">‚öôÔ∏è</button>

    <script>
        // --- TV√Å KONFIGURACE FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE",
            authDomain: "nadeje-208bd.firebaseapp.com",
            databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "nadeje-208bd",
            storageBucket: "nadeje-208bd.firebasestorage.app",
            messagingSenderId: "688478977789",
            appId: "1:688478977789:web:512d1520cf96c9e59cc894"
        };

        // Inicializace Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        const ADMIN_HESLO = "fotbal2024";
        const VKLAD = 20;
        let adminMode = false;
        let vyhodnoceno = false;

        // Synchronizace dat v re√°ln√©m ƒçase
        db.ref('sazkyData').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) vykresliWeb(data);
        });

        function vykresliWeb(data) {
            document.getElementById('txtDomaci').innerText = data.domaci || "T√Ωm A";
            document.getElementById('txtHoste').innerText = data.hoste || "T√Ωm B";
            
            const imgEl = document.getElementById('hlavniObrazek');
            if (data.foto) {
                imgEl.src = data.foto;
                imgEl.style.display = 'block';
            } else {
                imgEl.style.display = 'none';
            }
            
            const seznam = data.seznamSazek ? Object.values(data.seznamSazek) : [];
            const bank = (data.prevedenyBank || 0) + (seznam.length * VKLAD);
            document.getElementById('bankDisplay').innerText = `üí∞ Celkov√Ω bank: ${bank} Kƒç`;

            const tbody = document.getElementById('tabulkaBody');
            tbody.innerHTML = "";
            
            if (data.seznamSazek) {
                Object.keys(data.seznamSazek).forEach(key => {
                    const s = data.seznamSazek[key];
                    const tr = document.createElement("tr");
                    if (s.stav && s.stav.includes("V√ùHRA")) tr.className = "win";
                    
                    const zobrazit = !s.skryto || adminMode || (data.stavZapasu === 'vyhodnoceno');
                    
                    tr.innerHTML = `
                        <td>${s.jmeno}</td>
                        <td class="${zobrazit ? '' : 'secret-cell'}">${zobrazit ? s.skore : 'üôà Skryto'}</td>
                        <td class="${zobrazit ? '' : 'secret-cell'}">${zobrazit ? s.strelec : 'üôà Skryto'}</td>
                        <td>${s.stav || '‚è≥ Vsadil'}</td>
                        <td style="display:${adminMode ? 'table-cell' : 'none'}">
                            <button class="btn-delete" onclick="smazatJednuSazku('${key}')">Smazat</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }

        function ulozitSazku() {
            const jmeno = document.getElementById('jmeno').value;
            if(!jmeno) return alert("Zadej jm√©no!");
            
            db.ref('sazkyData/seznamSazek').push({
                jmeno,
                skore: `${document.getElementById('tip_domaci').value}:${document.getElementById('tip_hoste').value}`,
                strelec: document.getElementById('tip_strelec').value || "-",
                skryto: document.getElementById('skrytTip').checked,
                stav: "‚è≥ Vsadil"
            });

            document.getElementById('jmeno').value = "";
            document.getElementById('tip_strelec').value = "";
            document.getElementById('skrytTip').checked = false;
        }

        function vyhodnotit() {
            const rd = document.getElementById('real_domaci').value;
            const rh = document.getElementById('real_hoste').value;
            const vysledek = `${rd}:${rh}`;
            
            db.ref('sazkyData').once('value', (snapshot) => {
                const data = snapshot.val();
                const seznamS entries = data.seznamSazek ? Object.entries(data.seznamSazek) : [];
                const celkovyBank = (data.prevedenyBank || 0) + (seznamS entries.length * VKLAD);
                
                const vyherci = seznamS entries.filter(item => item[1].skore === vysledek);
                
                let updates = {};
                if (vyherci.length > 0) {
                    const podil = Math.floor(celkovyBank / vyherci.length);
                    seznamS entries.forEach(([key, s]) => {
                        updates[`seznamSazek/${key}/stav`] = (s.skore === vysledek) ? `V√ùHRA! üéâ (+${podil} Kƒç)` : "Prohra ‚ùå";
                    });
                    updates['prevedenyBank'] = 0;
                } else {
                    seznamS entries.forEach(([key, s]) => {
                        updates[`seznamSazek/${key}/stav`] = "Nikdo netrefil ‚ùå";
                    });
                    updates['prevedenyBank'] = celkovyBank;
                }
                
                updates['stavZapasu'] = 'vyhodnoceno';
                db.ref('sazkyData').update(updates);
            });
        }

        function nastavitZapas() {
            const updates = {};
            if(document.getElementById('set_domaci').value) updates['domaci'] = document.getElementById('set_domaci').value;
            if(document.getElementById('set_hoste').value) updates['hoste'] = document.getElementById('set_hoste').value;
            if(document.getElementById('set_url').value) updates['foto'] = document.getElementById('set_url').value;
            updates['stavZapasu'] = 'sazi_se';
            db.ref('sazkyData').update(updates);
        }

        function smazatSazky() {
            if(confirm("Vymazat seznam s√°zka≈ô≈Ø pro nov√© kolo?")) {
                db.ref('sazkyData/seznamSazek').remove();
                db.ref('sazkyData').update({ stavZapasu: 'sazi_se' });
            }
        }

        function smazatJednuSazku(key) {
            if(confirm("Opravdu smazat tuto s√°zku?")) {
                db.ref(`sazkyData/seznamSazek/${key}`).remove();
            }
        }

        function otevritAdmin() {
            const h = prompt("Zadej administr√°torsk√© heslo:");
            if (h === ADMIN_HESLO) {
                adminMode = true;
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('th-akce').style.display = 'table-cell';
                aktualizovatWeb(); // Re-render pro zobrazen√≠ smazat tlaƒç√≠tek
            }
        }

        function zavritAdmin() {
            adminMode = false;
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('th-akce').style.display = 'none';
            aktualizovatWeb();
        }

        function odkrytAdmin() {
            adminMode = true;
            aktualizovatWeb();
        }
    </script>
</body>
</html>
