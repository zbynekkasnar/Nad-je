<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KANCEL√Å≈ò NADƒöJE v2.0</title>
    <script src="stats.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root { 
            --neon: #00f2ff; 
            --dark: #0f172a; 
            --card-bg: rgba(255, 255, 255, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body { 
            background: var(--dark); 
            color: white; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            padding: 15px; 
            text-align: center; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            overflow-x: hidden; 
        }

        /* ANIMOVAN√â LOGO */
        .header-logo { 
            max-width: 320px; 
            width: 85%; 
            filter: drop-shadow(0 0 15px var(--neon)); 
            margin-bottom: 25px; 
            opacity: 0; 
            transform: scale(0.8); 
            animation: logoIntro 2.5s ease-out forwards; 
        }

        @keyframes logoIntro {
            0% { opacity: 0; transform: scale(0.8) translateY(-20px); }
            50% { opacity: 1; transform: scale(1.05) translateY(0); }
            100% { opacity: 0.8; transform: scale(1); }
        }

        /* BANK BOX */
        .bank-box { 
            background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,242,255,0.1)); 
            border: 1px solid var(--neon); 
            border-radius: 20px; 
            padding: 25px; 
            min-width: 280px; 
            margin-bottom: 35px; 
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.15); 
            transition: var(--transition);
        }
        .bank-box span { font-size: 2.8em; font-weight: 900; text-shadow: 0 0 15px var(--neon); }
        .bank-label { display: block; opacity: 0.5; font-size: 0.7em; letter-spacing: 2px; margin-bottom: 8px; text-transform: uppercase; }

        .btn-stats { 
            display: inline-block; 
            margin-bottom: 30px; 
            padding: 12px 28px; 
            background: rgba(0, 242, 255, 0.05); 
            border: 1px solid var(--neon); 
            color: var(--neon); 
            text-decoration: none; 
            border-radius: 50px; 
            font-size: 0.9em; 
            font-weight: bold; 
            letter-spacing: 1px; 
            transition: var(--transition); 
        }
        .btn-stats:hover { background: var(--neon); color: black; box-shadow: 0 0 25px var(--neon); }

        /* Z√ÅPASY */
        #matchList { width: 100%; max-width: 600px; }

        .match-card { 
            background: var(--card-bg); 
            border-radius: 24px; 
            border: 1px solid rgba(255,255,255,0.1); 
            margin-bottom: 25px; 
            padding: 25px; 
            cursor: pointer; 
            transition: var(--transition); 
            position: relative; 
            overflow: hidden;
        }
        .match-card:hover { border-color: var(--neon); background: rgba(255,255,255,0.08); }

        /* 3D VLAJKY */
        .flags-wrapper { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 10px; 
            margin: 10px 0;
        }
        .flag-container { 
            perspective: 1000px; 
            text-align: center; 
            width: 100px;
        }
        .flag-img { 
            width: 85px; 
            height: auto; 
            border-radius: 6px; 
            animation: flagWave 4s ease-in-out infinite; 
            transform-origin: left center; 
            border-left: 2px solid rgba(255,255,255,0.4);
            box-shadow: 0 12px 25px rgba(0,0,0,0.5);
        }
        @keyframes flagWave {
            0%, 100% { transform: rotateY(0deg) rotateX(0deg); }
            50% { transform: rotateY(20deg) rotateX(5deg); }
        }
        .country-name { display: block; font-size: 0.75em; opacity: 0.5; margin-top: 10px; font-weight: bold; }
        .vs { 
            background: var(--neon); 
            color: black; 
            border-radius: 50%; 
            width: 38px; 
            height: 38px; 
            line-height: 38px; 
            font-weight: 900; 
            box-shadow: 0 0 15px var(--neon);
        }

        .timer-box { 
            font-size: 0.85em; 
            font-weight: 800; 
            color: var(--neon); 
            background: rgba(0,0,0,0.5); 
            padding: 8px 18px; 
            border-radius: 50px; 
            border: 1px solid rgba(0,242,255,0.2);
        }

        /* FORMUL√Å≈ò */
        .details { 
            display: none; 
            padding-top: 30px; 
            border-top: 1px solid rgba(255,255,255,0.1); 
            margin-top: 25px; 
            text-align: left; 
            animation: fadeIn 0.4s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .input-label { font-size: 0.75em; font-weight: bold; opacity: 0.6; text-transform: uppercase; margin-bottom: 8px; display: block; }
        .name-input { 
            width: 100%; padding: 15px; margin-bottom: 20px; 
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); 
            color: white; border-radius: 12px; font-size: 1em; box-sizing: border-box;
            transition: var(--transition);
        }
        .name-input:focus { border-color: var(--neon); outline: none; background: rgba(0,242,255,0.05); }

        .score-container { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 10px 0 25px 0; }
        .score-input { 
            width: 75px; height: 60px; text-align: center; font-weight: 900; font-size: 1.8em; 
            background: #000; border: 2px solid #334155; color: white; border-radius: 15px; 
        }

        .switch-row { display: flex; align-items: center; gap: 12px; margin: 20px 0; background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; }
        .switch { position: relative; display: inline-block; width: 48px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #334155; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background: var(--neon); }
        input:checked + .slider:before { transform: translateX(24px); }

        .btn-add { 
            width: 100%; background: var(--neon); color: black; border: none; padding: 18px; 
            border-radius: 15px; font-weight: 900; cursor: pointer; font-size: 1.1em; 
            text-transform: uppercase; letter-spacing: 1px; transition: var(--transition);
        }
        .btn-add:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,242,255,0.4); }

        /* S√ÅZKY OSTATN√çCH */
        .bets-header { font-weight: bold; font-size: 0.85em; opacity: 0.4; margin: 30px 0 15px 0; text-transform: uppercase; letter-spacing: 1px; }
        .bet-row { 
            padding: 14px; border-radius: 15px; margin-bottom: 10px; 
            border-left: 4px solid var(--neon); display: flex; flex-direction: column; gap: 4px;
        }
        .bet-main { display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .bet-player { font-size: 0.85em; color: var(--neon); opacity: 0.8; }

        /* KO≈†√çK */
        #cart { 
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); 
            width: 92%; max-width: 480px; background: #1e293b; border: 2px solid var(--neon); 
            border-radius: 30px; padding: 30px; display: none; z-index: 2000; 
            box-shadow: 0 0 60px rgba(0,0,0,0.9); 
        }
    </style>
</head>
<body>

    <img src="IMG_8427.png" alt="KANCEL√Å≈ò NADƒöJE" class="header-logo">

    <div class="bank-box">
        <span class="bank-label">Aktu√°ln√≠ bank v h≈ôe</span>
        <span id="mainBank">0</span> Kƒç
    </div>

    <a href="statistiky.html" class="btn-stats">üìä ≈ΩEB≈ò√çƒåKY A STATISTIKY</a>

    <div id="matchList"></div>

    <div id="cart">
        <span style="position:absolute; top:20px; right:25px; font-size:2em; cursor:pointer;" onclick="closeCart()">√ó</span>
        <div id="cartContent">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="text-align:left;">
                    <b id="cartCount" style="font-size:1.3em;">0 z√°pas≈Ø</b><br>
                    <span id="cartTotal" style="color:var(--neon); font-size:1.8em; font-weight:900;">0 Kƒç</span>
                </div>
                <button id="sendBtn" class="btn-add" style="width:auto; padding: 12px 30px;" onclick="odeslatTiket()">ODESLAT</button>
            </div>
        </div>
        <div id="qrArea" style="display:none; text-align:center; margin-top:15px;">
            <div id="qrStatus" style="margin-bottom:20px; font-weight:bold; color:var(--neon); font-size:1.2em;"></div>
            <div style="background:white; padding:20px; border-radius:20px; display:inline-block;"><img id="qrImg" src="" style="width:200px; display:block;"></div>
            <p id="qrDesc" style="font-size:0.9em; margin-top:20px; opacity:0.7;"></p>
        </div>
    </div>

<script>
    // Konfigurace Firebase
    const firebaseConfig = { 
        apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE", 
        authDomain: "nadeje-208bd.firebaseapp.com", 
        databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app", 
        projectId: "nadeje-208bd", 
        storageBucket: "nadeje-208bd.firebasestorage.app", 
        messagingSenderId: "688478977789", 
        appId: "1:688478977789:web:512d1520cf96c9e59cc894" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let kosik = {};
    let activeTimers = {};

    db.ref('sazkyData').on('value', snap => {
        const data = snap.val() || {};
        const list = document.getElementById('matchList');
        list.innerHTML = "";
        
        if (!data.zapasy) {
            document.getElementById('mainBank').innerText = data.prevedenyBank || 0;
            return;
        }

        const zapasy = Object.entries(data.zapasy).map(([id, m]) => ({id, ...m})).sort((a,b) => new Date(a.deadline) - new Date(b.deadline));
        const nejblizsi = zapasy[0];
        const vkladyZapas = nejblizsi.sazky ? Object.keys(nejblizsi.sazky).length * 20 : 0;
        document.getElementById('mainBank').innerText = parseInt(data.prevedenyBank || 0) + vkladyZapas;

        zapasy.forEach(m => {
            const id = m.id;
            activeTimers[id] = m.deadline;
            const isClosed = Date.now() > new Date(m.deadline).getTime();
            const isEvaluated = m.status === "vyhodnoceno";

            const card = document.createElement('div');
            card.className = "match-card";
            if(id === nejblizsi.id) card.style.borderColor = "var(--neon)";
            
            // VERZE 2: V≈ædy klikac√≠, i po uzav≈ôen√≠/vyhodnocen√≠
            card.onclick = () => toggle(id);

            const timerHtml = isEvaluated 
                ? `<div class="timer-box" style="background: #27ae60; color: white; border: none;">‚úÖ HOTOVO (${m.vysledek})</div>` 
                : `<div id="t-${id}" class="timer-box">--:--:--</div>`;

            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div style="color:var(--neon); font-size:0.75em; font-weight:900;">BANK: ${m.sazky ? Object.keys(m.sazky).length * 20 : 0} Kƒç</div>
                    ${timerHtml}
                </div>
                <div class="flags-wrapper">
                    <div class="flag-container">
                        <img class="flag-img" src="https://flagcdn.com/w160/${m.kodD}.png">
                        <span class="country-name">${m.domaci}</span>
                    </div>
                    <div class="vs">VS</div>
                    <div class="flag-container">
                        <img class="flag-img" src="https://flagcdn.com/w160/${m.kodH}.png">
                        <span class="country-name">${m.hoste}</span>
                    </div>
                </div>
                <div id="det-${id}" class="details" onclick="event.stopPropagation()">
                    ${(!isClosed && !isEvaluated) ? `
                        <span class="input-label">Jm√©no s√°zej√≠c√≠ho</span>
                        <input type="text" id="name-${id}" class="name-input" placeholder="Tv√© jm√©no">
                        <span class="input-label" style="text-align:center;">Tip na v√Ωsledek</span>
                        <div class="score-container">
                            <input type="number" id="sD-${id}" class="score-input">
                            <div style="font-weight:900; font-size:1.5em; color:var(--neon);">:</div>
                            <input type="number" id="sH-${id}" class="score-input">
                        </div>
                        <span class="input-label">St≈ôelec g√≥lu</span>
                        <input type="text" id="p-${id}" class="name-input" placeholder="nap≈ô. Pastr≈à√°k">
                        <div class="switch-row">
                            <label class="switch"><input type="checkbox" id="h-${id}"><span class="slider"></span></label>
                            <span style="font-size:0.85em; opacity:0.8;">Skr√Ωt m≈Øj tip do deadline</span>
                        </div>
                        <button class="btn-add" onclick="pridat('${id}')">P≈òIDAT NA TIKET (20 Kƒç)</button>
                    ` : `<div style="text-align:center; color:var(--neon); font-weight:bold; margin-bottom:15px;">üîí S√ÅZKY UZAV≈òENY</div>`}
                    
                    <div class="bets-header">P≈ôehled v≈°ech tip≈Ø</div>
                    <div id="bets-${id}"></div>
                </div>
            `;
            list.appendChild(card);

            if(m.sazky) {
                const countsSkore = {}; const countsFull = {};
                Object.values(m.sazky).forEach(s => {
                    const full = `${s.skore}-${s.strelec.toLowerCase().trim()}`;
                    countsSkore[s.skore] = (countsSkore[s.skore] || 0) + 1;
                    countsFull[full] = (countsFull[full] || 0) + 1;
                });

                Object.values(m.sazky).forEach(s => {
                    const fullKey = `${s.skore}-${s.strelec.toLowerCase().trim()}`;
                    const showAll = isClosed || isEvaluated;
                    let bgColor = "rgba(255,255,255,0.03)";
                    if (countsFull[fullKey] > 1) bgColor = "rgba(255, 165, 0, 0.15)";
                    else if (countsSkore[s.skore] > 1) bgColor = "rgba(255, 255, 0, 0.08)";

                    const row = `
                        <div class="bet-row" style="background: ${bgColor};">
                            <div class="bet-main">
                                <span>${s.stav || "‚è≥"} ${s.jmeno}</span>
                                <span style="color:var(--neon)">${(s.skryt && !showAll) ? '??:??' : s.skore}</span>
                            </div>
                            <div class="bet-player">üèí ${(s.skryt && !showAll) ? '*******' : (s.strelec || '---')}</div>
                        </div>`;
                    document.getElementById(`bets-${id}`).innerHTML += row;
                });
            }
        });
    });

    function toggle(id) {
        const el = document.getElementById(`det-${id}`);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    function closeCart() { document.getElementById('cart').style.display = 'none'; }

    function pridat(id) {
        const jm = document.getElementById(`name-${id}`).value;
        const sD = document.getElementById(`sD-${id}`).value;
        const sH = document.getElementById(`sH-${id}`).value;
        const p = document.getElementById(`p-${id}`).value;
        const skryt = document.getElementById(`h-${id}`).checked;

        if(!jm || sD === "" || sH === "" || !p) return alert("Vypl≈à pros√≠m v≈°e!");

        db.ref(`sazkyData/zapasy/${id}/sazky`).once('value', snap => {
            const exist = snap.val() || {};
            if(Object.values(exist).some(s => s.skore === `${sD}:${sH}` && s.strelec.toLowerCase().trim() === p.toLowerCase().trim())) {
                return alert("‚ö†Ô∏è Tato kombinace u≈æ je obsazen√°!");
            }
            kosik[id] = { jmeno: jm, skore: `${sD}:${sH}`, strelec: p, skryt: skryt };
            document.getElementById('cartCount').innerText = `${Object.keys(kosik).length} z√°pas≈Ø`;
            document.getElementById('cartTotal').innerText = `${Object.keys(kosik).length * 20} Kƒç`;
            document.getElementById('cart').style.display = 'block';
            toggle(id);
        });
    }

    function odeslatTiket() {
        const btn = document.getElementById('sendBtn');
        btn.disabled = true;
        let jmenoHrace = "";
        Object.entries(kosik).forEach(([mid, data]) => {
            db.ref(`sazkyData/zapasy/${mid}/sazky`).push({ ...data, stav: "‚è≥" });
            jmenoHrace = data.jmeno;
        });
        const suma = Object.keys(kosik).length * 20;
        const zprava = `Sazka_${jmenoHrace}`.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        document.getElementById('cartContent').style.display = 'none';
        document.getElementById('qrImg').src = `https://api.paylibo.com/paylibo/generator/czech/image?accountNumber=295511827&bankCode=0300&amount=${suma}&currency=CZK&message=${zprava}`;
        document.getElementById('qrDesc').innerHTML = `ƒå√°stka: <b>${suma} Kƒç</b><br>Zpr√°va: <b>${zprava}</b>`;
        document.getElementById('qrArea').style.display = 'block';
        kosik = {};
    }

    setInterval(() => {
        const now = Date.now();
        Object.entries(activeTimers).forEach(([id, deadline]) => {
            const el = document.getElementById(`t-${id}`);
            if(!el) return;
            const diff = new Date(deadline).getTime() - now;
            if(diff <= 0) {
                el.innerText = "üîê ZAV≈òENO"; el.style.color = "#ff4444";
            } else {
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                el.innerText = `‚è±Ô∏è ${h}h ${m}m ${s}s`;
            }
        });
    }, 1000);
</script>
</body>
</html>
