<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√°zkov√° kancel√°≈ô NADƒöJE</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 15px; display: flex; flex-direction: column; align-items: center; margin: 0; padding-bottom: 50px; }
        .main-wrapper { width: 100%; max-width: 500px; box-shadow: 0 4px 25px rgba(0,0,0,0.1); border-radius: 15px; overflow: hidden; background: white; margin-bottom: 20px; }
        .logo-container { background: white; width: 100%; text-align: center; }
        .main-logo { width: 100%; height: auto; display: block; }
        .content-box { padding: 20px; }
        .bank-info { background: #2c3e50; color: #f1c40f; text-align: center; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 1.4em; font-weight: bold; width: 100%; max-width: 470px; }
        .countdown { background: #e74c3c; color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-weight: bold; font-family: monospace; font-size: 1.2em; text-align: center; }
        .zapas-nazev { text-align: center; font-size: 1.6em; font-weight: bold; margin-bottom: 15px; color: #2c3e50; }
        .no-match { text-align: center; padding: 20px; color: #7f8c8d; font-style: italic; font-size: 1.2em; line-height: 1.5; }
        .mood-container { width: 100%; max-width: 500px; margin-bottom: 20px; text-align: center; }
        .mood-bar { display: flex; height: 25px; border-radius: 12px; overflow: hidden; background: #eee; }
        .mood-part { display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75em; font-weight: bold; transition: width 0.6s ease; }
        .mood-1 { background: #3498db; } .mood-0 { background: #95a5a6; } .mood-2 { background: #e74c3c; }
        .score-input { display: flex; align-items: center; justify-content: center; gap: 10px; margin: 10px 0; }
        input { padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; outline: none; }
        input[type="number"] { width: 70px; text-align: center; font-weight: bold; }
        .switch-container { display: flex; flex-direction: column; align-items: center; gap: 8px; margin: 15px 0; background: #f8f9fa; padding: 12px; border-radius: 12px; border: 1px solid #eee; }
        .switch { position: relative; display: inline-block; width: 60px; height: 30px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #3498db; }
        input:checked + .slider:before { transform: translateX(30px); }
        .status-text { font-size: 0.8em; font-weight: bold; margin-top: 5px; }
        .status-public { color: #3498db; } .status-private { color: #e67e22; }
        button#btnOdeslat { background: #28a745; color: white; border: none; padding: 15px; cursor: pointer; width: 100%; border-radius: 8px; font-weight: bold; font-size: 1.1em; margin-top: 10px; }
        table { width: 100%; max-width: 500px; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        th, td { padding: 12px 10px; text-align: center; border-bottom: 1px solid #eee; font-size: 0.85em; }
        th { background: #34495e; color: white; text-transform: uppercase; }
        .win { background: #d4edda !important; font-weight: bold; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; }
        .modal-content { background-color: white; padding: 25px; border-radius: 20px; text-align: center; max-width: 320px; width: 85%; }
        .modal-content img { width: 100%; height: auto; border-radius: 10px; margin: 15px 0; }
        .close-btn { background: #34495e; color: white; padding: 12px; border: none; border-radius: 8px; width: 100%; font-weight: bold; }
        .footer-links { margin-top: 30px; display: flex; gap: 20px; }
        .footer-links a { text-decoration: none; color: #7f8c8d; font-weight: bold; }
    </style>
</head>
<body>
    <div id="qrModal" class="modal"><div class="modal-content"><h2>S√°zka p≈ôijata! ‚úÖ</h2><p>Zapla≈• 20 Kƒç:</p><img src="platba.png"><button class="close-btn" onclick="zavritQR()">ZAV≈ò√çT</button></div></div>
    <div class="bank-info" id="bankDisplay">üí∞ Naƒç√≠t√°n√≠...</div>
    <div class="main-wrapper">
        <div class="logo-container"><img src="IMG_8423.jpeg" class="main-logo"></div>
        <div class="content-box">
            <div id="zapasAktivni" style="display:none;">
                <div id="timerDisplay" class="countdown">Naƒç√≠t√°m...</div>
                <div class="zapas-nazev"><span id="txtDomaci">...</span> VS <span id="txtHoste">...</span></div>
                <input type="text" id="jmeno" placeholder="Tv√© jm√©no">
                <div class="score-input"><input type="number" id="tip_domaci" value="0"><span>:</span><input type="number" id="tip_hoste" value="0"></div>
                <input type="text" id="tip_strelec" placeholder="Tip na st≈ôelce">
                <div class="switch-container">
                    <label class="switch"><input type="checkbox" id="verejna_sazka" checked onchange="updateSwitchText()"><span class="slider"></span></label>
                    <span id="switchStatus" class="status-text status-public">üîì VE≈òEJN√ù TIP</span>
                </div>
                <button id="btnOdeslat" onclick="ulozitSazku()">ODESLAT S√ÅZKU (20 Kƒç)</button>
            </div>
            <div id="zapasZadny" class="no-match" style="display:none;">üì≠ Aktu√°lnƒõ nen√≠ vyps√°n ≈æ√°dn√Ω z√°pas.</div>
        </div>
    </div>
    <div id="moodContainer" class="mood-container" style="display:none;">
        <div class="mood-bar"><div id="moodDomaci" class="mood-part mood-1"></div><div id="moodRemiza" class="mood-part mood-0"></div><div id="moodHoste" class="mood-part mood-2"></div></div>
    </div>
    <table id="tabulkaSazek" style="display:none;"><thead><tr><th>S√°zka≈ô</th><th>Tip</th><th>St≈ôelec</th><th>Stav</th></tr></thead><tbody id="tabulkaBody"></tbody></table>
    <div class="footer-links"><a href="statistiky.html">üìä Statistiky</a><a href="admin.html" style="opacity: 0.1;">‚öôÔ∏è</a></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE", authDomain: "nadeje-208bd.firebaseapp.com", databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app", projectId: "nadeje-208bd", storageBucket: "nadeje-208bd.firebasestorage.app", messagingSenderId: "688478977789", appId: "1:688478977789:web:512d1520cf96c9e59cc894" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let aktualniDeadline = null;

        const normalize = (str) => str ? str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim() : "";

        function updateSwitchText() {
            const isPublic = document.getElementById('verejna_sazka').checked;
            document.getElementById('switchStatus').innerText = isPublic ? "üîì VE≈òEJN√ù TIP" : "üîí SKRYT√ù TIP";
        }

        setInterval(() => {
            if (!aktualniDeadline) return;
            const rozdil = new Date(aktualniDeadline).getTime() - new Date().getTime();
            if (rozdil <= 0) { document.getElementById('timerDisplay').innerText = "UZAV≈òENO"; document.getElementById('btnOdeslat').disabled = true; return; }
            const h = Math.floor(rozdil / 3600000); const m = Math.floor((rozdil % 3600000) / 60000); const s = Math.floor((rozdil % 60000) / 1000);
            document.getElementById('timerDisplay').innerText = `Do v√Ωkopu: ${h}h ${m}m ${s}s`;
        }, 1000);

        db.ref('sazkyData').on('value', (snapshot) => {
            const data = snapshot.val();
            const nemaZapas = !data || !data.domaci || data.domaci.trim() === "";
            if (nemaZapas) {
                document.getElementById('zapasAktivni').style.display = 'none'; document.getElementById('zapasZadny').style.display = 'block';
                document.getElementById('tabulkaSazek').style.display = 'none'; document.getElementById('moodContainer').style.display = 'none';
                document.getElementById('bankDisplay').innerText = `üí∞ Jackpot: ${data?.prevedenyBank || 0} Kƒç`; return;
            }
            document.getElementById('zapasAktivni').style.display = 'block'; document.getElementById('zapasZadny').style.display = 'none';
            document.getElementById('tabulkaSazek').style.display = 'table'; document.getElementById('txtDomaci').innerText = data.domaci;
            document.getElementById('txtHoste').innerText = data.hoste; aktualniDeadline = data.deadline;
            const seznam = data.seznamSazek ? Object.values(data.seznamSazek) : [];
            const bank = (data.prevedenyBank || 0) + (seznam.length * 20);
            document.getElementById('bankDisplay').innerText = `üí∞ Celkov√Ω bank: ${bank} Kƒç`;

            if (seznam.length > 0) {
                let d = 0, r = 0, h = 0;
                seznam.forEach(s => { const res = s.skore.split(':'); if (parseInt(res[0]) > parseInt(res[1])) d++; else if (parseInt(res[0]) < parseInt(res[1])) h++; else r++; });
                document.getElementById('moodContainer').style.display = 'block';
                document.getElementById('moodDomaci').style.width = Math.round((d/seznam.length)*100) + "%";
                document.getElementById('moodRemiza').style.width = Math.round((r/seznam.length)*100) + "%";
                document.getElementById('moodHoste').style.width = Math.round((h/seznam.length)*100) + "%";
            }

            const deadlineProsel = data.deadline && new Date() > new Date(data.deadline);
            const vStrelciNorm = normalize(data.posledniStrelec || "").split(',').map(s => s.trim());

            const tbody = document.getElementById('tabulkaBody'); tbody.innerHTML = "";
            if (data.seznamSazek) {
                Object.values(data.seznamSazek).reverse().forEach(s => {
                    const skryto = !deadlineProsel && !s.verejne;
                    const tipNorm = normalize(s.strelec);
                    const trefilS = tipNorm !== "" && vStrelciNorm.some(v => tipNorm.includes(v) || v.includes(tipNorm));
                    const tr = document.createElement("tr"); if (s.stav && s.stav.includes("V√ùHRA")) tr.className = "win";
                    tr.innerHTML = `<td>${s.jmeno}</td><td>${skryto ? "üïµÔ∏è" : s.skore}</td><td>${skryto ? "üîí" : (trefilS ? 'üéØ '+s.strelec : s.strelec)}</td><td>${s.stav || '‚è≥'}</td>`;
                    tbody.appendChild(tr);
                });
            }
        });

        function ulozitSazku() {
            const j = document.getElementById('jmeno').value.trim(); if(!j) return alert("Jm√©no!");
            db.ref('sazkyData/seznamSazek').push({
                jmeno: j, skore: document.getElementById('tip_domaci').value + ":" + document.getElementById('tip_hoste').value,
                strelec: document.getElementById('tip_strelec').value.trim() || "-", verejne: document.getElementById('verejna_sazka').checked,
                stav: "‚è≥ Vsadil", timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => { document.getElementById('qrModal').style.display = 'flex'; });
        }
        function zavritQR() { document.getElementById('qrModal').style.display = 'none'; }
    </script>
</body>
</html>
