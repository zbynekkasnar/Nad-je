<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KANCEL√Å≈ò NADƒöJE v4.0</title>

    <script src="stats.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        /* --- Z√ÅKLADN√ç NASTAVEN√ç A PROMƒöNN√â --- */
        :root {
            --neon: #00f2ff;
            --dark: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.2s ease;
        }

        body {
            background-color: var(--dark);
            color: #ffffff;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- FIXN√ç PRVKY --- */
        .admin-lock {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid var(--neon);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 1.3em;
            z-index: 9999;
            transition: var(--transition-slow);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .admin-lock:hover {
            transform: rotate(180deg) scale(1.1);
            background: var(--neon);
            box-shadow: 0 0 30px var(--neon);
        }

        /* --- ANIMOVAN√â LOGO --- */
        .header-logo {
            max-width: 450px;
            width: 90%;
            margin: 20px 0 40px 0;
            filter: drop-shadow(0 0 10px rgba(0, 242, 255, 0.5));
            animation: neonGlow 4s ease-in-out infinite alternate;
        }

        @keyframes neonGlow {
            0% { filter: drop-shadow(0 0 5px var(--neon)); transform: scale(1); }
            100% { filter: drop-shadow(0 0 25px var(--neon)); transform: scale(1.02); }
        }

        /* --- BANKOVN√ç SYST√âM --- */
        .bank-box {
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(0,242,255,0.08) 100%);
            border: 1px solid rgba(0, 242, 255, 0.4);
            border-radius: 30px;
            padding: 30px;
            min-width: 300px;
            margin-bottom: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }

        .bank-label {
            display: block;
            opacity: 0.5;
            font-size: 0.75em;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .bank-main-val {
            font-size: 3.2em;
            font-weight: 900;
            text-shadow: 0 0 20px var(--neon);
            line-height: 1;
            margin-bottom: 15px;
        }

        .bank-total-row {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }

        .bank-total-label {
            font-size: 0.7em;
            opacity: 0.6;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .bank-total-val {
            font-weight: 800;
            color: var(--neon);
            font-size: 1.3em;
        }

        /* --- NAVIGACE --- */
        .btn-stats {
            display: inline-block;
            margin-bottom: 40px;
            padding: 16px 35px;
            background: rgba(0, 242, 255, 0.05);
            border: 1px solid var(--neon);
            color: var(--neon);
            text-decoration: none;
            border-radius: 100px;
            font-weight: 900;
            transition: var(--transition-slow);
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        .btn-stats:hover {
            background: var(--neon);
            color: var(--dark);
            box-shadow: 0 0 40px var(--neon);
            transform: translateY(-3px);
        }

        /* --- Z√ÅPASY - KARTY --- */
        #matchList {
            width: 100%;
            max-width: 650px;
            padding-bottom: 120px;
        }

        .match-card {
            background: var(--card-bg);
            border-radius: 35px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 35px;
            padding: 30px;
            cursor: pointer;
            transition: var(--transition-slow);
            position: relative;
            backdrop-filter: blur(15px);
        }

        .match-card:hover {
            border-color: var(--neon);
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.01);
        }

        /* --- BAROMETR ROZLO≈ΩEN√ç --- */
        .barometer-container {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin: 25px 0 12px 0;
            display: flex;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .bar-1 { height: 100%; background: #38a169; transition: 1s ease-out; }
        .bar-0 { height: 100%; background: #718096; transition: 1s ease-out; }
        .bar-2 { height: 100%; background: #3182ce; transition: 1s ease-out; }

        .bar-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.65em;
            opacity: 0.7;
            font-weight: 800;
            margin-bottom: 20px;
            letter-spacing: 0.5px;
        }

        /* --- 3D ANIMOVAN√â VLAJKY --- */
        .flags-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        .flag-container {
            perspective: 1000px;
            text-align: center;
            width: 120px;
        }

        .flag-img {
            width: 90px;
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            animation: flagWave 5s ease-in-out infinite;
            transform-origin: left center;
            border-left: 2px solid rgba(255,255,255,0.3);
        }

        @keyframes flagWave {
            0%, 100% { transform: rotateY(0deg) rotateX(0deg); }
            50% { transform: rotateY(30deg) rotateX(5deg); }
        }

        .vs-circle {
            background: var(--neon);
            color: var(--dark);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            line-height: 45px;
            font-weight: 900;
            font-size: 1em;
            box-shadow: 0 0 20px var(--neon);
            z-index: 2;
        }

        .timer-box {
            font-size: 0.9em;
            font-weight: 800;
            color: var(--neon);
            background: rgba(0,0,0,0.6);
            padding: 10px 20px;
            border-radius: 100px;
            border: 1px solid rgba(0, 242, 255, 0.2);
        }

        /* --- DETAIL S√ÅZEN√ç --- */
        .details {
            display: none;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
            text-align: left;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-field {
            width: 100%;
            padding: 18px;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.15);
            color: #ffffff;
            border-radius: 20px;
            font-size: 1.1em;
            box-sizing: border-box;
            outline: none;
            transition: var(--transition-fast);
        }

        .input-field:focus {
            border-color: var(--neon);
            background: rgba(0,0,0,0.6);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.1);
        }

        .score-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin: 25px 0;
        }

        .score-input {
            width: 85px;
            height: 75px;
            text-align: center;
            font-weight: 900;
            font-size: 2.2em;
            background: #000000;
            border: 3px solid #334155;
            color: #ffffff;
            border-radius: 22px;
            outline: none;
            transition: var(--transition-fast);
        }

        .score-input:focus {
            border-color: var(--neon);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
        }

        .hide-tip-row {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.03);
            padding: 15px 20px;
            border-radius: 20px;
            margin-bottom: 30px;
            cursor: pointer;
        }

        .btn-add-ticket {
            width: 100%;
            background: var(--neon);
            color: var(--dark);
            border: none;
            padding: 22px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 1.1em;
            cursor: pointer;
            text-transform: uppercase;
            transition: var(--transition-fast);
            letter-spacing: 1px;
        }

        .btn-add-ticket:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 242, 255, 0.3);
        }

        /* --- PLOVOUC√ç TLAƒå√çTKO (FAB) --- */
        .fab-cart {
            position: fixed;
            bottom: 35px;
            right: 35px;
            width: 75px;
            height: 75px;
            background: var(--neon);
            color: var(--dark);
            border-radius: 50%;
            display: none; /* Zapne JS */
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            z-index: 5000;
            box-shadow: 0 15px 40px rgba(0, 242, 255, 0.4);
            animation: fabBounce 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes fabBounce {
            from { transform: scale(0) rotate(-90deg); }
            to { transform: scale(1) rotate(0); }
        }

        .fab-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 0.45em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            border: 3px solid var(--dark);
        }

        /* --- MOD√ÅL TIKETU --- */
        #cartModal {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 94%;
            max-width: 520px;
            background: #1e293b;
            border: 2px solid var(--neon);
            border-radius: 40px;
            padding: 35px;
            display: none;
            z-index: 9999;
            box-shadow: 0 0 100px rgba(0,0,0,0.9);
            max-height: 80vh;
            overflow-y: auto;
        }

        .cart-item {
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            padding: 15px 20px;
            margin-bottom: 12px;
            border-left: 5px solid var(--neon);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- PLATEBN√ç BOX PO ODESL√ÅN√ç --- */
        .payment-details-box {
            background: rgba(0,0,0,0.5);
            border-radius: 25px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid rgba(0, 242, 255, 0.15);
            text-align: left;
        }

        .pay-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .pay-row:last-child { border: none; margin: 0; padding: 0; }

        .pay-key {
            font-size: 0.8em;
            opacity: 0.5;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .pay-val {
            font-weight: 900;
            color: var(--neon);
            font-size: 1em;
            letter-spacing: 0.5px;
        }

        /* --- SEZNAM S√ÅZEK NA KARTƒö --- */
        .bet-row-ui {
            background: rgba(255,255,255,0.03);
            border-radius: 18px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--neon);
            display: flex;
            flex-direction: column;
        }

        .bet-header-ui {
            display: flex;
            justify-content: space-between;
            font-weight: 900;
            font-size: 0.95em;
            margin-bottom: 5px;
        }

        .bet-meta-ui {
            font-size: 0.85em;
            opacity: 0.6;
        }

        .win-glow { color: #f1c40f; text-shadow: 0 0 10px rgba(241,196,15,0.5); }
        .loss-dim { color: #ff4444; opacity: 0.5; }

        /* SCROLLBAR */
        #cartModal::-webkit-scrollbar { width: 6px; }
        #cartModal::-webkit-scrollbar-thumb { background: var(--neon); border-radius: 10px; }
    </style>
</head>
<body>

    <a href="admin.html" class="admin-lock">‚öôÔ∏è</a>

    <img src="IMG_8427.jpeg" class="header-logo" alt="KANCEL√Å≈ò NADƒöJE">

    <div class="bank-box">
        <span class="bank-label">Maxim√°ln√≠ v√Ωhra pro dne≈°ek</span>
        <div class="bank-main-val"><span id="uiMainBank">0</span> Kƒç</div>
        <div class="bank-total-row">
            <span class="bank-total-label">Celkov√Ω bank v h≈ôe:</span>
            <span class="bank-total-val"><span id="uiTotalBank">0</span> Kƒç</span>
        </div>
    </div>

    <a href="statistiky.html" class="btn-stats">üìä ≈ΩEB≈ò√çƒåKY A STATISTIKY</a>

    <div id="matchList"></div>

    <div id="fabCart" class="fab-cart" onclick="uiOpenCart()">
        üéüÔ∏è <div id="fabBadge" class="fab-badge">0</div>
    </div>

    <div id="cartModal">
        <span style="position:absolute; top:20px; right:35px; font-size:2.5em; cursor:pointer; opacity:0.4;" onclick="uiCloseCart()">√ó</span>
        
        <div id="cartViewPre">
            <h2 style="text-align:left; color:var(--neon); margin-bottom:25px;">Tv≈Øj tiket</h2>
            <div id="cartItemsContainer"></div>
            
            <div style="margin-top:30px; padding-top:25px; border-top:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center;">
                <div style="text-align:left">
                    <span style="font-size:0.8em; opacity:0.5; text-transform:uppercase;">Celkov√° s√°zka</span><br>
                    <span id="uiCartTotal" style="font-size:2.2em; font-weight:900; color:var(--neon)">0 Kƒç</span>
                </div>
                <button class="btn-add-ticket" style="width:auto; padding:15px 40px;" onclick="actionSendTicket()">ODESLAT</button>
            </div>
        </div>

        <div id="cartViewPost" style="display:none; text-align:center;">
            <div style="font-weight:900; color:var(--neon); font-size:1.6em; margin-bottom:25px;">‚úÖ TIKET BYL P≈òIJAT!</div>
            
            <img id="uiQrImage" src="" style="width:240px; background:white; padding:12px; border-radius:25px; box-shadow: 0 0 40px rgba(0,0,0,0.5);">
            
            <div class="payment-details-box">
                <div class="pay-row">
                    <span class="pay-key">ƒå√≠slo √∫ƒçtu:</span>
                    <span class="pay-val">295511827 / 0300</span>
                </div>
                <div class="pay-row">
                    <span class="pay-key">ƒå√°stka:</span>
                    <span class="pay-val" id="uiPayAmount">0 Kƒç</span>
                </div>
                <div class="pay-row">
                    <span class="pay-key">Zpr√°va pro p≈ô√≠jemce:</span>
                    <span class="pay-val" id="uiPayMessage">---</span>
                </div>
            </div>

            <p style="font-size:0.85em; opacity:0.5; margin-top:20px; line-height:1.5;">
                Platbu proveƒète obratem. Va≈°e s√°zky budou <br>aktivov√°ny po p≈ôips√°n√≠ penƒõz.
            </p>
            
            <button class="btn-add-ticket" style="margin-top:15px;" onclick="uiCloseCart()">ZAV≈ò√çT TIKET</button>
        </div>
    </div>

<script>
    // --- FIREBASE KONFIGURACE ---
    const firebaseConfig = { 
        apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE", 
        authDomain: "nadeje-208bd.firebaseapp.com", 
        databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app", 
        projectId: "nadeje-208bd", 
        storageBucket: "nadeje-208bd.firebasestorage.app", 
        messagingSenderId: "688478977789", 
        appId: "1:688478977789:web:512d1520cf96c9e59cc894" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- GLOB√ÅLN√ç PROMƒöNN√â ---
    let localCart = {};
    let activeDeadlines = {};

    // --- NAƒå√çT√ÅN√ç DAT V RE√ÅLN√âM ƒåASE ---
    db.ref('sazkyData').on('value', snap => {
        const data = snap.val() || {};
        const container = document.getElementById('matchList');
        container.innerHTML = "";

        const prevBank = parseInt(data.prevedenyBank || 0);
        
        // Pokud nejsou z√°pasy
        if (!data.zapasy) {
            document.getElementById('uiMainBank').innerText = prevBank;
            document.getElementById('uiTotalBank').innerText = prevBank;
            return;
        }

        // Se≈ôazen√≠ z√°pas≈Ø podle ƒçasu
        const zapasy = Object.entries(data.zapasy)
            .map(([id, m]) => ({ id, ...m }))
            .sort((a, b) => new Date(a.deadline) - new Date(b.deadline));

        // V√Ωpoƒçet bank≈Ø
        let sumActiveBets = 0;
        zapasy.forEach(z => {
            if (z.status !== "vyhodnoceno" && z.sazky) {
                sumActiveBets += Object.keys(z.sazky).length * 20;
            }
        });

        const aktivniZ = zapasy.filter(z => z.status !== "vyhodnoceno");
        const vkladyDnes = (aktivniZ.length > 0 && aktivniZ[0].sazky) ? Object.keys(aktivniZ[0].sazky).length * 20 : 0;

        document.getElementById('uiMainBank').innerText = prevBank + vkladyDnes;
        document.getElementById('uiTotalBank').innerText = prevBank + sumActiveBets;

        // Vykreslen√≠ karet
        zapasy.forEach(m => {
            activeDeadlines[m.id] = m.deadline;
            const now = Date.now();
            const target = new Date(m.deadline).getTime();
            const isClosed = now > target;
            const isEvaluated = m.status === "vyhodnoceno";

            // Barometr logika
            let t1=0, t0=0, t2=0, totalCount=0;
            if(m.sazky) {
                Object.values(m.sazky).forEach(s => {
                    const parts = s.skore.split(':');
                    const d = parseInt(parts[0]), h = parseInt(parts[1]);
                    if(d > h) t1++; else if(d === h) t0++; else t2++;
                    totalCount++;
                });
            }
            const p1 = totalCount ? (t1/totalCount)*100 : 33.3;
            const p0 = totalCount ? (t0/totalCount)*100 : 33.3;
            const p2 = totalCount ? (t2/totalCount)*100 : 33.3;

            const card = document.createElement('div');
            card.className = "match-card";
            card.onclick = () => uiToggleMatch(m.id);

            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:18px;">
                    <div style="color:var(--neon); font-size:0.75em; font-weight:900; letter-spacing:1px;">BANK: ${totalCount*20} Kƒç</div>
                    ${isEvaluated ? 
                        `<div style="background:#27ae60; color:white; padding:6px 16px; border-radius:100px; font-weight:900; font-size:0.8em">V√ùSLEDEK ${m.vysledek}</div>` : 
                        `<div id="timer-${m.id}" class="timer-box">--:--:--</div>`
                    }
                </div>

                <div class="flags-wrapper">
                    <div class="flag-container">
                        <img class="flag-img" src="https://flagcdn.com/w160/${m.kodD}.png">
                        <br><small style="font-weight:800; opacity:0.8; display:block; margin-top:8px;">${m.domaci}</small>
                    </div>
                    <div class="vs-circle">VS</div>
                    <div class="flag-container">
                        <img class="flag-img" src="https://flagcdn.com/w160/${m.kodH}.png">
                        <br><small style="font-weight:800; opacity:0.8; display:block; margin-top:8px;">${m.hoste}</small>
                    </div>
                </div>

                <div class="barometer-container">
                    <div class="bar-1" style="width:${p1}%"></div>
                    <div class="bar-0" style="width:${p0}%"></div>
                    <div class="bar-2" style="width:${p2}%"></div>
                </div>
                <div class="bar-labels">
                    <span>${m.domaci.substring(0,3).toUpperCase()} ${Math.round(p1)}%</span>
                    <span>REM√çZA ${Math.round(p0)}%</span>
                    <span>${m.hoste.substring(0,3).toUpperCase()} ${Math.round(p2)}%</span>
                </div>

                <div id="detail-${m.id}" class="details" onclick="event.stopPropagation()">
                    ${(!isClosed && !isEvaluated) ? `
                        <div class="input-group">
                            <input type="text" id="name-${m.id}" class="input-field" placeholder="Zadej sv√© jm√©no">
                        </div>
                        <div class="score-row">
                            <input type="number" id="scD-${m.id}" class="score-input" placeholder="0">
                            <span style="font-size:2.5em; font-weight:900; color:var(--neon)">:</span>
                            <input type="number" id="scH-${m.id}" class="score-input" placeholder="0">
                        </div>
                        <div class="input-group">
                            <input type="text" id="striker-${m.id}" class="input-field" placeholder="Kdo d√° g√≥l? (p≈ô√≠jmen√≠)">
                        </div>
                        <div class="hide-tip-row" onclick="document.getElementById('hide-${m.id}').click()">
                            <input type="checkbox" id="hide-${m.id}" style="width:22px; height:22px; cursor:pointer;">
                            <span style="font-size:0.95em; font-weight:600; opacity:0.9">Skr√Ωt m≈Øj tip p≈ôed ostatn√≠mi</span>
                        </div>
                        <button class="btn-add-ticket" onclick="actionAddToTicket('${m.id}', '${m.domaci} vs ${m.hoste}')">P≈òIDAT NA TIKET (20 Kƒç)</button>
                    ` : `<div style="text-align:center; color:var(--neon); font-weight:900; letter-spacing:1px; margin-bottom:20px;">S√ÅZKY UZAV≈òENY</div>`}
                    
                    <div id="bets-list-${m.id}" style="margin-top:30px;"></div>
                </div>
            `;
            container.appendChild(card);

            // Vykreslen√≠ historie s√°zek v detailu
            if (m.sazky) {
                const bList = document.getElementById(`bets-list-${m.id}`);
                Object.values(m.sazky).forEach(s => {
                    const reveal = isClosed || isEvaluated;
                    let statusHtml = "‚è≥";
                    if(isEvaluated) {
                        statusHtml = s.stav === "üèÜ" ? `<span class="win-glow">üèÜ V√ùHRA</span>` : `<span class="loss-dim">‚ùå</span>`;
                    }

                    const displaySkore = (s.skryt && !reveal) ? '??:??' : s.skore;
                    const displayStrelec = (s.skryt && !reveal) ? '*******' : (s.strelec || '---');

                    bList.innerHTML += `
                        <div class="bet-row-ui">
                            <div class="bet-header-ui">
                                <span>${statusHtml} ${s.jmeno}</span>
                                <span style="color:var(--neon)">${displaySkore}</span>
                            </div>
                            <div class="bet-meta-ui">üéØ St≈ôelec: ${displayStrelec}</div>
                        </div>
                    `;
                });
            }
        });
    });

    // --- FUNKCE ROZHRAN√ç ---
    function uiToggleMatch(id) {
        const el = document.getElementById(`detail-${id}`);
        const all = document.querySelectorAll('.details');
        all.forEach(d => { if(d.id !== `detail-${id}`) d.style.display = 'none'; });
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    function uiUpdateFAB() {
        const count = Object.keys(localCart).length;
        const fab = document.getElementById('fabCart');
        const badge = document.getElementById('fabBadge');
        if(count > 0) {
            fab.style.display = 'flex';
            badge.innerText = count;
        } else {
            fab.style.display = 'none';
        }
    }

    function uiOpenCart() {
        const list = document.getElementById('cartItemsContainer');
        list.innerHTML = "";
        let sum = 0;

        Object.entries(localCart).forEach(([id, data]) => {
            sum += 20;
            list.innerHTML += `
                <div class="cart-item">
                    <div>
                        <div style="font-size:0.7em; opacity:0.5; font-weight:800;">${data.matchName}</div>
                        <div style="font-weight:900; font-size:1.1em;">${data.jmeno} | <span style="color:var(--neon)">${data.skore}</span></div>
                    </div>
                    <div style="color:#ff4444; font-size:1.8em; font-weight:900; cursor:pointer; padding-left:15px;" onclick="actionRemoveFromCart('${id}')">√ó</div>
                </div>
            `;
        });

        document.getElementById('uiCartTotal').innerText = `${sum} Kƒç`;
        document.getElementById('cartViewPre').style.display = 'block';
        document.getElementById('cartViewPost').style.display = 'none';
        document.getElementById('cartModal').style.display = 'block';
    }

    function uiCloseCart() {
        document.getElementById('cartModal').style.display = 'none';
    }

    // --- AKCE ---
    function actionAddToTicket(id, mName) {
        const name = document.getElementById(`name-${id}`).value;
        const sD = document.getElementById(`scD-${id}`).value;
        const sH = document.getElementById(`scH-${id}`).value;
        const striker = document.getElementById(`striker-${id}`).value;
        const isHidden = document.getElementById(`hide-${id}`).checked;

        if(!name || sD==="" || sH==="" || !striker) return alert("Vypl≈à pros√≠m v≈°echna pole s√°zky!");

        // Kontrola duplicity (Sk√≥re + St≈ôelec)
        db.ref(`sazkyData/zapasy/${id}/sazky`).once('value', snap => {
            const data = snap.val() || {};
            const isDup = Object.values(data).some(s => 
                s.skore === `${sD}:${sH}` && 
                s.strelec.toLowerCase().trim() === striker.toLowerCase().trim()
            );

            if(isDup) return alert("Tento p≈ôesn√Ω tip (sk√≥re i st≈ôelec) u≈æ v syst√©mu je. Zkus jin√©ho st≈ôelce nebo v√Ωsledek!");

            localCart[id] = {
                jmeno: name,
                skore: `${sD}:${sH}`,
                strelec: striker,
                skryt: isHidden,
                matchName: mName
            };

            uiUpdateFAB();
            uiToggleMatch(id);
        });
    }

    function actionRemoveFromCart(id) {
        delete localCart[id];
        uiUpdateFAB();
        if(Object.keys(localCart).length === 0) uiCloseCart();
        else uiOpenCart();
    }

    function actionSendTicket() {
        let lastUser = "";
        Object.entries(localCart).forEach(([mid, data]) => {
            db.ref(`sazkyData/zapasy/${mid}/sazky`).push({
                jmeno: data.jmeno,
                skore: data.skore,
                strelec: data.strelec,
                skryt: data.skryt,
                stav: "‚è≥"
            });
            lastUser = data.jmeno;
        });

        const totalSum = Object.keys(localCart).length * 20;
        const msg = `Sazka_${lastUser}`.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        
        // Nastaven√≠ QR a detail≈Ø
        document.getElementById('uiQrImage').src = `https://api.paylibo.com/paylibo/generator/czech/image?accountNumber=295511827&bankCode=0300&amount=${totalSum}&currency=CZK&message=${msg}`;
        document.getElementById('uiPayAmount').innerText = `${totalSum} Kƒç`;
        document.getElementById('uiPayMessage').innerText = msg;

        document.getElementById('cartViewPre').style.display = 'none';
        document.getElementById('cartViewPost').style.display = 'block';
        
        localCart = {};
        uiUpdateFAB();
    }

    // --- ƒåASOVAƒåE (SMYƒåKA) ---
    setInterval(() => {
        const now = Date.now();
        Object.entries(activeDeadlines).forEach(([id, dl]) => {
            const el = document.getElementById(`timer-${id}`);
            if(!el) return;

            const target = new Date(dl).getTime();
            const diff = target - now;

            if(diff <= 0) {
                el.innerText = "üîê UZAV≈òENO";
                el.style.color = "#ff4444";
                el.style.borderColor = "#ff4444";
            } else {
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                el.innerText = `‚è±Ô∏è ${h}h ${m}m ${s}s`;
            }
        });
    }, 1000);

</script>
</body>
</html>
