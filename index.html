<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√°zkov√° kancel√°≈ô NADƒöJE</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 15px; display: flex; flex-direction: column; align-items: center; margin: 0; padding-bottom: 50px; }
        .main-wrapper { width: 100%; max-width: 500px; box-shadow: 0 4px 25px rgba(0,0,0,0.1); border-radius: 15px; overflow: hidden; background: white; margin-bottom: 20px; }
        .logo-container { background: white; width: 100%; text-align: center; padding: 15px 0; border-bottom: 1px solid #eee; }
        .main-logo { max-width: 70%; height: auto; display: block; margin: 0 auto; }
        .header-image { width: 100%; height: 180px; object-fit: cover; display: none; background-color: #ddd; }
        .content-box { padding: 20px; }
        .bank-info { background: #2c3e50; color: #f1c40f; text-align: center; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 1.4em; font-weight: bold; width: 100%; max-width: 470px; }
        .deadline-info { background: #fdf3d8; color: #856404; padding: 10px; border-radius: 8px; font-size: 0.85em; margin-bottom: 15px; text-align: center; border: 1px solid #ffeeba; }
        .zapas-nazev { text-align: center; font-size: 1.6em; font-weight: bold; margin-bottom: 15px; color: #2c3e50; }
        .score-input { display: flex; align-items: center; justify-content: center; gap: 10px; margin: 10px 0; }
        input { padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; outline: none; }
        input:focus { border-color: #3498db; }
        input[type="number"] { width: 70px; text-align: center; font-weight: bold; }
        button#btnOdeslat { background: #28a745; color: white; border: none; padding: 15px; cursor: pointer; width: 100%; border-radius: 8px; font-weight: bold; font-size: 1.1em; margin-top: 10px; transition: 0.2s; }
        button#btnOdeslat:active { transform: scale(0.98); background: #218838; }
        
        table { width: 100%; max-width: 500px; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        th, td { padding: 12px 10px; text-align: center; border-bottom: 1px solid #eee; font-size: 0.9em; }
        th { background: #34495e; color: white; text-transform: uppercase; font-size: 0.75em; }
        .win { background: #d4edda !important; font-weight: bold; color: #155724; }
        
        /* MODAL QR PLATBA */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; }
        .modal-content { background-color: white; padding: 25px; border-radius: 20px; text-align: center; max-width: 320px; width: 85%; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .modal-content img { width: 100%; height: auto; border-radius: 10px; margin: 15px 0; border: 1px solid #eee; }
        .close-btn { background: #34495e; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }

        .footer-links { margin-top: 30px; display: flex; gap: 20px; }
        .footer-links a { text-decoration: none; color: #7f8c8d; font-weight: bold; font-size: 0.9em; }
    </style>
</head>
<body>

    <div id="qrModal" class="modal">
        <div class="modal-content">
            <h2 style="margin:0; color:#2c3e50;">S√°zka p≈ôijata! ‚úÖ</h2>
            <p style="color:#666; font-size: 0.9em; margin-top: 10px;">Pros√≠m o zaplacen√≠ <b>20 Kƒç</b>:</p>
            <img src="platba.png" alt="QR k√≥d">
            <button class="close-btn" onclick="zavritQR()">HOTOVO / ZAV≈ò√çT</button>
        </div>
    </div>

    <div class="bank-info" id="bankDisplay">üí∞ Naƒç√≠t√°n√≠ banku...</div>

    <div class="main-wrapper">
        <div class="logo-container">
            <img src="IMG_8423.jpeg" class="main-logo" alt="NADƒöJE" onerror="this.alt='S√°zkov√° kancel√°≈ô NADƒöJE'">
        </div>
        <img id="hlavniObrazek" src="" class="header-image">
        <div class="content-box">
            <div id="deadlineDisplay" class="deadline-info">Zji≈°≈•uji ƒças startu...</div>
            <div id="zobrazenyZapas" class="zapas-nazev">
                <span id="txtDomaci">...</span> VS <span id="txtHoste">...</span>
            </div>
            
            <input type="text" id="jmeno" placeholder="Tv√© jm√©no" style="margin-bottom:10px">
            <div class="score-input">
                <input type="number" id="tip_domaci" min="0" value="0">
                <span>:</span>
                <input type="number" id="tip_hoste" min="0" value="0">
            </div>
            <input type="text" id="tip_strelec" placeholder="Tip na st≈ôelce (nepovinn√©)" style="margin-top:10px">
            <button id="btnOdeslat" onclick="ulozitSazku()">ODESLAT S√ÅZKU (20 Kƒç)</button>
        </div>
    </div>

    <table>
        <thead>
            <tr><th>S√°zka≈ô</th><th>Tip</th><th>St≈ôelec</th><th>Stav</th></tr>
        </thead>
        <tbody id="tabulkaBody"></tbody>
    </table>

    <div class="footer-links">
        <a href="statistiky.html">üìä Statistiky</a>
        <a href="admin.html" style="opacity: 0.3;">‚öôÔ∏è</a>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE",
            authDomain: "nadeje-208bd.firebaseapp.com",
            databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "nadeje-208bd",
            storageBucket: "nadeje-208bd.firebasestorage.app",
            messagingSenderId: "688478977789",
            appId: "1:688478977789:web:512d1520cf96c9e59cc894"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let aktualniDeadline = null;

        // Naƒç√≠t√°n√≠ dat v re√°ln√©m ƒçase
        db.ref('sazkyData').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                document.getElementById('txtDomaci').innerText = data.domaci || "T√Ωm A";
                document.getElementById('txtHoste').innerText = data.hoste || "T√Ωm B";
                aktualniDeadline = data.deadline;
                
                if(data.deadline) {
                    const d = new Date(data.deadline);
                    document.getElementById('deadlineDisplay').innerText = "S√°zky konƒç√≠: " + d.toLocaleString('cs-CZ', {day:'numeric', month:'numeric', hour:'2-digit', minute:'2-digit'});
                } else {
                    document.getElementById('deadlineDisplay').innerText = "Deadline nen√≠ nastaven.";
                }

                if(data.foto) {
                    document.getElementById('hlavniObrazek').src = data.foto;
                    document.getElementById('hlavniObrazek').style.display = 'block';
                } else {
                    document.getElementById('hlavniObrazek').style.display = 'none';
                }
                
                const seznam = data.seznamSazek ? Object.values(data.seznamSazek) : [];
                const bank = (data.prevedenyBank || 0) + (seznam.length * 20);
                document.getElementById('bankDisplay').innerText = `üí∞ Celkov√Ω bank: ${bank} Kƒç`;

                const tbody = document.getElementById('tabulkaBody');
                tbody.innerHTML = "";
                if (data.seznamSazek) {
                    // Se≈ôad√≠me s√°zky od nejnovƒõj≈°√≠ch
                    const serazeneSazky = Object.values(data.seznamSazek).reverse();
                    serazeneSazky.forEach(s => {
                        const tr = document.createElement("tr");
                        if (s.stav && s.stav.includes("V√ùHRA")) tr.className = "win";
                        tr.innerHTML = `<td>${s.jmeno}</td><td>${s.skore}</td><td>${s.strelec}</td><td>${s.stav || '‚è≥'}</td>`;
                        tbody.appendChild(tr);
                    });
                }
            }
        });

        function ulozitSazku() {
            // Kontrola ƒçasu
            if (aktualniDeadline && new Date() > new Date(aktualniDeadline)) {
                alert("BOHU≈ΩEL! Z√°pas u≈æ zaƒçal, s√°zky jsou uzav≈ôeny.");
                return;
            }

            const jmeno = document.getElementById('jmeno').value.trim();
            const tDomaci = document.getElementById('tip_domaci').value;
            const tHoste = document.getElementById('tip_hoste').value;
            const strelec = document.getElementById('tip_strelec').value.trim();

            if(!jmeno) return alert("Zadej sv√© jm√©no!");
            
            db.ref('sazkyData/seznamSazek').push({
                jmeno: jmeno,
                skore: tDomaci + ":" + tHoste,
                strelec: strelec || "-",
                stav: "‚è≥ Vsadil",
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                // Vymaz√°n√≠ pol√≠ƒçek po √∫spƒõ≈°n√©m odesl√°n√≠
                document.getElementById('jmeno').value = "";
                document.getElementById('tip_domaci').value = "0";
                document.getElementById('tip_hoste').value = "0";
                document.getElementById('tip_strelec').value = "";
                
                // Zobrazen√≠ QR k√≥du
                document.getElementById('qrModal').style.display = 'flex';
            }).catch((error) => {
                alert("Chyba p≈ôi odes√≠l√°n√≠: " + error.message);
            });
        }

        function zavritQR() {
            document.getElementById('qrModal').style.display = 'none';
        }
    </script>
</body>
</html>
