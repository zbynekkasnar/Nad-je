<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiky - NADÄšJE</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px; margin-bottom: 20px; }
        h1 { color: #2c3e50; } h3 { border-bottom: 2px solid #f1c40f; padding-bottom: 8px; margin-top: 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; font-size: 0.9em; }
        th { background: #34495e; color: white; }
        .val { font-weight: bold; text-align: center; color: #28a745; }
        .back-btn { padding: 10px 20px; background: #34495e; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ“Š Statistiky NADÄšJE</h1>
    <div class="card">
        <h3>ğŸ¯ Experti (Trefy)</h3>
        <table><thead><tr><th>JmÃ©no</th><th style="text-align:center">Trefy</th></tr></thead><tbody id="trefyBody"></tbody></table>
    </div>
    <div class="card">
        <h3>ğŸ’° VÃ½herci (PenÃ­ze)</h3>
        <table><thead><tr><th>JmÃ©no</th><th style="text-align:center">KÄ</th></tr></thead><tbody id="vyhryBody"></tbody></table>
    </div>
    <div class="card">
        <h3>âš½ Lovci stÅ™elcÅ¯</h3>
        <table><thead><tr><th>JmÃ©no</th><th style="text-align:center">GÃ³ly</th></tr></thead><tbody id="strelciBody"></tbody></table>
    </div>
    <a href="index.html" class="back-btn">â¬… ZpÄ›t</a>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE",
            authDomain: "nadeje-208bd.firebaseapp.com",
            databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "nadeje-208bd",
            storageBucket: "nadeje-208bd.firebasestorage.app",
            messagingSenderId: "688478977789",
            appId: "1:688478977789:web:512d1520cf96c9e59cc894"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('historieSazek').on('value', (snapshot) => {
            const historie = snapshot.val();
            if (!historie) return;
            const stats = {};
            Object.values(historie).forEach(z => {
                const sZapasu = z.strelecZapasu ? z.strelecZapasu.toLowerCase().trim() : null;
                if (z.sazky) {
                    Object.values(z.sazky).forEach(s => {
                        if (!stats[s.jmeno]) stats[s.jmeno] = { trefy: 0, vyhry: 0, strelci: 0 };
                        if (s.skore === z.vysledek) { stats[s.jmeno].trefy++; stats[s.jmeno].vyhry += z.vyhraNaHlavu; }
                        if (sZapasu && s.strelec && s.strelec.toLowerCase().trim() === sZapasu) stats[s.jmeno].strelci++;
                    });
                }
            });
            const data = Object.entries(stats).map(([jmeno, d]) => ({ jmeno, ...d }));
            
            vykresli('trefyBody', [...data].sort((a,b)=>b.trefy-a.trefy), 'trefy', 'x');
            vykresli('vyhryBody', [...data].sort((a,b)=>b.vyhry-a.vyhry), 'vyhry', ' KÄ');
            vykresli('strelciBody', [...data].filter(h=>h.strelci>0).sort((a,b)=>b.strelci-a.strelci), 'strelci', 'x');
        });

        function vykresli(id, data, klic, jedn) {
            document.getElementById(id).innerHTML = data.map(h => `<tr><td>${h.jmeno}</td><td class="val">${h[klic]}${jedn}</td></tr>`).join('');
        }
    </script>
</body>
</html>
