<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiky - NADƒöJE</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 15px; display: flex; flex-direction: column; align-items: center; margin: 0; }
        .stats-container { width: 100%; max-width: 500px; margin-top: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { color: #2c3e50; font-size: 1.8em; margin-bottom: 5px; }
        h3 { margin-top: 0; border-bottom: 2px solid #f1c40f; padding-bottom: 10px; color: #34495e; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px 8px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #34495e; color: white; font-size: 0.8em; text-transform: uppercase; }
        .rank { font-weight: bold; color: #7f8c8d; width: 30px; }
        .name { font-weight: bold; color: #2c3e50; }
        .val { text-align: center; font-weight: bold; color: #28a745; }
        .back-btn { display: inline-block; margin-top: 20px; padding: 10px 20px; background: #34495e; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; }
        .gold { background: #fff9e6; }
    </style>
</head>
<body>

    <h1>üìä Statistiky NADƒöJE</h1>
    <p style="color: #7f8c8d; margin-bottom: 20px;">Historick√© v√Ωsledky v≈°ech kol</p>

    <div class="stats-container">
        <div class="card">
            <h3>üéØ Nejvƒõt≈°√≠ Experti</h3>
            <table>
                <thead>
                    <tr><th class="rank">#</th><th>Jm√©no</th><th style="text-align:center">P≈ôesn√© trefy</th></tr>
                </thead>
                <tbody id="trefyBody">
                    <tr><td colspan="3" style="text-align:center">Naƒç√≠t√°n√≠ historie...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h3>üí∞ Nejvƒõt≈°√≠ V√Ωhry</h3>
            <table>
                <thead>
                    <tr><th class="rank">#</th><th>Jm√©no</th><th style="text-align:center">Celkem vybr√°no</th></tr>
                </thead>
                <tbody id="vyhryBody">
                    <tr><td colspan="3" style="text-align:center">Naƒç√≠t√°n√≠ historie...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <a href="index.html" class="back-btn">‚¨Ö Zpƒõt na s√°zky</a>

    <script>
        // TV√â KONFIGURACE FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE",
            authDomain: "nadeje-208bd.firebaseapp.com",
            databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "nadeje-208bd",
            storageBucket: "nadeje-208bd.firebasestorage.app",
            messagingSenderId: "688478977789",
            appId: "1:688478977789:web:512d1520cf96c9e59cc894"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Naƒçten√≠ historie
        db.ref('historieSazek').on('value', (snapshot) => {
            const historie = snapshot.val();
            if (!historie) {
                const emptyMsg = "<tr><td colspan='3' style='text-align:center'>Zat√≠m nebyl vyhodnocen ≈æ√°dn√Ω z√°pas.</td></tr>";
                document.getElementById('trefyBody').innerHTML = emptyMsg;
                document.getElementById('vyhryBody').innerHTML = emptyMsg;
                return;
            }

            const stats = {};

            // Proch√°zen√≠ v≈°ech archivovan√Ωch z√°pas≈Ø
            Object.values(historie).forEach(zapas => {
                const realVysledek = zapas.vysledek;
                const vyhraNaHlavu = zapas.vyhraNaHlavu || 0;

                if (zapas.sazky) {
                    Object.values(zapas.sazky).forEach(s => {
                        if (!stats[s.jmeno]) {
                            stats[s.jmeno] = { trefy: 0, vyhry: 0 };
                        }

                        if (s.skore === realVysledek) {
                            stats[s.jmeno].trefy += 1;
                            stats[s.jmeno].vyhry += vyhraNaHlavu;
                        }
                    });
                }
            });

            // P≈ôevod na pole a se≈ôazen√≠
            const poleStats = Object.entries(stats).map(([jmeno, data]) => ({ jmeno, ...data }));

            // 1. Se≈ôazen√≠ podle tref
            const podleTref = [...poleStats].sort((a, b) => b.trefy - a.trefy);
            vykresliTabulku('trefyBody', podleTref, 'trefy', 'x');

            // 2. Se≈ôazen√≠ podle penƒõz
            const podleVyher = [...poleStats].sort((a, b) => b.vyhry - a.vyhry);
            vykresliTabulku('vyhryBody', podleVyher, 'vyhry', ' Kƒç');
        });

        function vykresliTabulku(id, data, klic, jednotka) {
            const tbody = document.getElementById(id);
            tbody.innerHTML = "";
            data.forEach((hrac, index) => {
                const tr = document.createElement("tr");
                if (index === 0) tr.className = "gold";
                tr.innerHTML = `
                    <td class="rank">${index + 1}.</td>
                    <td class="name">${hrac.jmeno}</td>
                    <td class="val">${hrac[klic]}${jednotka}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>
