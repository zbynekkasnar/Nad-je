<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - KANCEL√Å≈ò NADƒöJE</title>
    <script src="stats.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; padding: 20px; color: #1a202c; }
        .card { background: white; padding: 25px; border-radius: 15px; max-width: 550px; margin: 0 auto 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; color: #2d3748; border-bottom: 2px solid #edf2f7; padding-bottom: 10px; }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 0.9em; color: #4a5568; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #cbd5e0; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
        .btn { padding: 12px; border: none; border-radius: 8px; color: white; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold; text-transform: uppercase; transition: 0.2s; }
        .btn-blue { background: #3182ce; } .btn-blue:hover { background: #2b6cb0; }
        .btn-green { background: #38a169; } .btn-green:hover { background: #2f855a; }
        .btn-red { background: #e53e3e; } .btn-red:hover { background: #c53030; }
        .match-item { background: #f8fafc; border: 1px solid #e2e8f0; padding: 15px; border-radius: 10px; margin-top: 15px; }
        .bet-info { font-size: 0.85em; background: #fff; padding: 5px 10px; border-radius: 5px; margin-top: 5px; border-left: 3px solid #3182ce; }
    </style>
</head>
<body onload="initAdmin()">

    <div class="card">
        <h2>üí∞ P≈ôeveden√Ω Bank</h2>
        <label>ƒå√°stka z minul√Ωch kol (Kƒç):</label>
        <input type="number" id="prevBankInput" placeholder="0">
        <button class="btn btn-blue" onclick="saveBank()">ULO≈ΩIT A AKTUALIZOVAT</button>
    </div>

    <div class="card">
        <h2>üöÄ Vypsat Nov√Ω Z√°pas</h2>
        <label>Dom√°c√≠ t√Ωm:</label>
        <input list="statyList" id="d" placeholder="Zaƒçni ps√°t n√°zev...">
        <label>Hostuj√≠c√≠ t√Ωm:</label>
        <input list="statyList" id="h" placeholder="Zaƒçni ps√°t n√°zev...">
        <label>Zaƒç√°tek z√°pasu (Deadline):</label>
        <input type="datetime-local" id="dl">
        <button class="btn btn-green" onclick="addM()">VYPSAT Z√ÅPAS DO NAB√çDKY</button>
    </div>

    <div class="card">
        <h2>üìä Aktivn√≠ Z√°pasy</h2>
        <div id="adminMatches">Naƒç√≠t√°m z√°pasy z datab√°ze...</div>
    </div>

    <datalist id="statyList"></datalist>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE", authDomain: "nadeje-208bd.firebaseapp.com", databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app", projectId: "nadeje-208bd", storageBucket: "nadeje-208bd.firebasestorage.app", messagingSenderId: "688478977789", appId: "1:688478977789:web:512d1520cf96c9e59cc894" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function initAdmin() {
            // Naƒçten√≠ na≈°ept√°vaƒçe ze stats.js
            const l = document.getElementById('statyList');
            if (typeof vsechnyStaty !== 'undefined') {
                vsechnyStaty.forEach(s => {
                    const o = document.createElement('option'); o.value = s.n;
                    l.appendChild(o);
                });
            }
            // Sledov√°n√≠ p≈ôeveden√©ho banku
            db.ref('sazkyData/prevedenyBank').on('value', snap => {
                document.getElementById('prevBankInput').value = snap.val() || 0;
            });
        }

        function saveBank() {
            const val = parseInt(document.getElementById('prevBankInput').value) || 0;
            db.ref('sazkyData/prevedenyBank').set(val).then(() => alert("Bank byl √∫spƒõ≈°nƒõ aktualizov√°n!"));
        }

        function addM() {
            const d = document.getElementById('d').value;
            const h = document.getElementById('h').value;
            const dl = document.getElementById('dl').value;
            
            if(!d || !h || !dl) return alert("‚ùå Mus√≠≈° vyplnit oba t√Ωmy i ƒças!");

            const kd = vsechnyStaty.find(s => s.n === d)?.c || "un";
            const kh = vsechnyStaty.find(s => s.n === h)?.c || "un";

            db.ref('sazkyData/zapasy').push({
                domaci: d, hoste: h, kodD: kd, kodH: kh, deadline: dl
            }).then(() => {
                alert("‚úÖ Z√°pas byl √∫spƒõ≈°nƒõ vyps√°n!");
                document.getElementById('d').value = "";
                document.getElementById('h').value = "";
                document.getElementById('dl').value = "";
            });
        }

        // Zobrazen√≠ z√°pas≈Ø pro spr√°vu
        db.ref('sazkyData/zapasy').on('value', snap => {
            const cont = document.getElementById('adminMatches');
            cont.innerHTML = "";
            const data = snap.val();
            
            if(!data) {
                cont.innerHTML = "<p style='color:gray'>≈Ω√°dn√© aktivn√≠ z√°pasy v nab√≠dce.</p>";
                return;
            }

            Object.entries(data).forEach(([id, m]) => {
                const div = document.createElement('div');
                div.className = 'match-item';
                const pocetSazek = m.sazky ? Object.keys(m.sazky).length : 0;
                
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between;">
                        <strong>${m.domaci} - ${m.hoste}</strong>
                        <span style="color:#3182ce">S√°zky: ${pocetSazek}</span>
                    </div>
                    <textarea id="raw-${id}" style="margin-top:10px; height:60px;" placeholder="Sem vlo≈æ text z Livesportu pro vyhodnocen√≠..."></textarea>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-green" style="font-size:0.8em;" onclick="evalM('${id}')">Vyhodnotit</button>
                        <button class="btn btn-red" style="font-size:0.8em;" onclick="deleteM('${id}')">Smazat</button>
                    </div>
                    <div id="bets-list-${id}" style="margin-top:10px;"></div>
                `;
                cont.appendChild(div);

                // Zobrazen√≠ s√°zej√≠c√≠ch pro kontrolu
                if(m.sazky) {
                    const bList = document.getElementById(`bets-list-${id}`);
                    Object.values(m.sazky).forEach(s => {
                        bList.innerHTML += `<div class="bet-info">${s.jmeno}: ${s.skore} (${s.strelec})</div>`;
                    });
                }
            });
        });

        function deleteM(id) {
            if(confirm("Opravdu smazat tento z√°pas? S√°zky budou ztraceny.")) {
                db.ref(`sazkyData/zapasy/${id}`).remove();
            }
        }

        function evalM(mid) {
            alert("Tady probƒõhne vyhodnocen√≠ podle Livesportu (p≈ôipravujeme parser)...");
            // Logika parseru, kterou jsme ≈ôe≈°ili d≈ô√≠ve, p≈ôijde sem
        }
    </script>
</body>
</html>
