<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Admin - Kancel치콏 Nad캩je</title>
    <script src="stats.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; max-width: 500px; margin: 0 auto 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; }
        .btn { padding: 10px; border: none; border-radius: 5px; color: white; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold; }
        .btn-blue { background: #3498db; } .btn-green { background: #27ae60; } .btn-red { background: #e74c3c; }
    </style>
</head>
<body onload="initAdmin()">

    <div class="card">
        <h2>游눯 Spr치va banku</h2>
        <p>Aktu치ln캩 p콏evedeno z minula:</p>
        <input type="number" id="prevBankInput">
        <button class="btn btn-blue" onclick="saveBank()">ULO콯IT BANK</button>
    </div>

    <div class="card">
        <h2>游 Vypsat z치pas</h2>
        <input list="statyList" id="d" placeholder="Dom치c칤">
        <input list="statyList" id="h" placeholder="Host칠">
        <input type="datetime-local" id="dl">
        <button class="btn btn-blue" onclick="addM()">VYPSAT</button>
    </div>

    <div id="adminMatches"></div>
    <datalist id="statyList"></datalist>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyC-NCdmsgA42FxnopKm92m1y5gUGw_z_uE", authDomain: "nadeje-208bd.firebaseapp.com", databaseURL: "https://nadeje-208bd-default-rtdb.europe-west1.firebasedatabase.app", projectId: "nadeje-208bd", storageBucket: "nadeje-208bd.firebasestorage.app", messagingSenderId: "688478977789", appId: "1:688478977789:web:512d1520cf96c9e59cc894" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function initAdmin() {
            vsechnyStaty.forEach(s => {
                const o = document.createElement('option'); o.value=s.n;
                document.getElementById('statyList').appendChild(o);
            });
            db.ref('sazkyData/prevedenyBank').on('value', snap => {
                document.getElementById('prevBankInput').value = snap.val() || 0;
            });
        }

        function saveBank() {
            const val = parseInt(document.getElementById('prevBankInput').value);
            db.ref('sazkyData/prevedenyBank').set(val);
            alert("Bank ulo쬰n!");
        }

        function addM() {
            const d = document.getElementById('d').value, h = document.getElementById('h').value, dl = document.getElementById('dl').value;
            const kd = vsechnyStaty.find(s => s.n === d)?.c || "un";
            const kh = vsechnyStaty.find(s => s.n === h)?.c || "un";
            db.ref('sazkyData/zapasy').push({ domaci: d, hoste: h, kodD: kd, kodH: kh, deadline: dl });
        }

        db.ref('sazkyData/zapasy').on('value', snap => {
            const cont = document.getElementById('adminMatches'); cont.innerHTML = "";
            const zapasy = snap.val();
            if(zapasy) Object.entries(zapasy).forEach(([id, m]) => {
                const div = document.createElement('div'); div.className = 'card';
                div.innerHTML = `<h3>${m.domaci} - ${m.hoste}</h3>
                    <textarea id="raw-${id}" placeholder="Vlo text z Livesportu..."></textarea>
                    <button class="btn btn-green" onclick="evalM('${id}')">VYHODNOTIT</button>
                    <button class="btn btn-red" onclick="db.ref('sazkyData/zapasy/${id}').remove()">SMAZAT</button>`;
                cont.appendChild(div);
            });
        });

        function evalM(mid) {
            const raw = document.getElementById(`raw-${mid}`).value;
            // Zde by byla tv치 logika parseru pro Livesport...
            // Po vyhodnocen칤 nezapome켿: pokud nikdo nevyhraje, p콏i캜ti (po캜et s치zek * 20) k prevedenyBank.
            alert("Vyhodnocov치n칤 spu코t캩no...");
        }
    </script>
</body>
</html>
